(self.webpackChunkmy_tasks=self.webpackChunkmy_tasks||[]).push([[792],{111:function(t,e,r){function n(t,e,r,n,a){i=t,o=e,s=r,d=n,c=a}r.d(e,{$v:function(){return n},LD:function(){return s},me:function(){return o},nY:function(){return c},vF:function(){return i}});var a=r(8327);let i=(0,a.b)("logger"),s=(0,a.b)("useCases"),o=(0,a.b)("notify"),c=(0,a.b)("colorSchema"),d=(0,a.b)("storage")},5480:function(t,e,r){function n(){return Boolean(document.startViewTransition)?t=>document.startViewTransition?.(t):a}r.d(e,{B:function(){return i}});const a=t=>t(),i={isSupported:Boolean(document.startViewTransition),apply:a,setEnabled:t=>{i.apply=t?n():a}};!function(){if("undefined"==typeof document)throw new Error("document is undefined");i.apply=n()}()},1969:function(t,e,r){function n(t){return{type:F,key:t}}function a(t){return{type:H,key:(0,W.g)(t)}}function i(t){return{type:Y,key:t}}r.d(e,{_h:function(){return k},L0:function(){return H},vf:function(){return Y},Qy:function(){return N},QO:function(){return $},p5:function(){return F},FR:function(){return S},CD:function(){return y},cJ:function(){return f},GK:function(){return v},Tl:function(){return D},r:function(){return a},Tz:function(){return i},x7:function(){return n},je:function(){return Q},gg:function(){return s.gg},hZ:function(){return A},Ro:function(){return R},UB:function(){return X},o4:function(){return I},Yv:function(){return _},jG:function(){return b},pd:function(){return C},tG:function(){return J},fg:function(){return nt},LR:function(){return K},qe:function(){return x}});var s=r(1727),o=r(4183),c=r(3756),d=r(9068),u=r(7128),l=r(3640),g=r(8708);const y="others",f="settings",p="Настройки",k="about",m="О приложении",v="store_state",h="Для разработчиков",_=[f,k,v],C={[f]:o.X["settings.svg"],[k]:o.X["help.svg"],[v]:o.X["state.svg"]},b={[f]:p,[k]:m,[v]:h},I={[f]:"Настройки приложения",[k]:"Описание всех плюшек приложения! 😊",[v]:"Актуальное состояние хранилища приложения"},T=t=>{const{type:e,key:r}=t;return{type:e,key:r}},B="Навигационный фильтр",w={key:{validators:[[c.K,(0,d.m)(B,"title")],[(0,u.Y)(_),(0,l.C)(B,"title")]],required:!0},type:{validators:[[c.K,(0,d.m)(B,"type")],[t=>t===y,`Поле "type: сущности ${B} не соответстует требуемому значению`]],required:!0}},x=t=>(0,g.U)(t,w,T,B),F="filter",S="inbox",E="Черновики",D="trash",L="Корзина",$="expired",O="Просроченные",N="completed",P="Завершённые",R=[S,$,N,D],X={[S]:E,[D]:L,[$]:O,[N]:P},A={[S]:"Задачи с не определенной датой и временем выполнения",[D]:"Удаленные задачи",[$]:"Задачи, у которых срок исполнения просрочен",[N]:"Задачи, которые успешно завершены"},Q={[S]:o.X["inbox.png"],[$]:o.X["expired.svg"],[N]:o.X["warning.png"],[D]:o.X["trash.gif"]},j=t=>{const{type:e,key:r}=t;return{type:e,key:r}},q="Навигационный фильтр",U={key:{validators:[[c.K,(0,d.m)(q,"title")],[(0,u.Y)(R),(0,l.C)(q,"title")]],required:!0},type:{validators:[[c.K,(0,d.m)(q,"type")],[t=>t===F,`Поле "type: сущности ${q} не соответстует требуемому значению`]],required:!0}},K=t=>(0,g.U)(t,U,j,q);var W=r(648),M=r(4303),G=r(140);const H="calendar",V=t=>{const{type:e,key:r}=t;return{type:e,key:r}},Z="Навигационный фильтр",z={key:{validators:[[M.F,(0,G.a)(Z,"key")]],required:!0},type:{validators:[[c.K,(0,d.m)(Z,"type")],[t=>t===H,`Поле "type: сущности ${Z} не соответстует требуемому значению`]],required:!0}},J=t=>(0,g.U)(t,z,V,Z),Y="category",tt=t=>{const{type:e,title:r,key:n}=t;return{type:e,key:n}},et="Навигационный фильтр",rt={key:{validators:[[M.F,(0,G.a)(et,"key")]],required:!0},type:{validators:[[c.K,(0,d.m)(et,"type")],[t=>t===Y,`Поле "type: сущности ${et} не соответстует требуемому значению`]],required:!0}},nt=t=>(0,g.U)(t,rt,tt,et)},9524:function(t,e,r){r.d(e,{r:function(){return a}});var n=r(1969);const a=t=>(0,n.r)(t)},836:function(t,e,r){function n(t){const e=s.C.getState();let r;switch(t.type){case"calendar":r=(0,i.tG)(t);break;case"filter":r=(0,i.LR)(t);break;case"category":r=(0,i.fg)(t);break;case"others":r=(0,i.qe)(t);break;default:return{error:{message:"Неверный тип навигационного фильтра",data:t}}}if(r.error)return r;const n=r.result;if(!1===(0,a.b)(n,e.navigationFilter)){if("category"===n.type&&!1===e.categories.ids.includes(n.key))return{error:{message:"Неверный идентификатор категории",data:n}};s.C.setState({...e,navigationFilter:n})}return{result:n}}r.d(e,{n:function(){return n}});var a=r(2677),i=r(1969),s=(r(2769),r(1264))},1264:function(t,e,r){function n(){u=(0,a.vt)()((()=>({...o.B5,tasks:{...o.B5.tasks,idsByCategoryId:{},idsByExpireDate:{},idsByFilterId:{[c.FR]:[],[c.QO]:[],[c.Qy]:[],[c.Tl]:[]}},navigationFilter:(0,d.r)(new Date((0,s.g)(new Date)))}))),(0,o.Uz)(u,i.v.child({layer:"[ DOMAIN ]"}))}r.d(e,{p:function(){return n},C:function(){return u}});var a=r(1621),i=r(2769),s=r(648),o=r(6169),c=r(1969),d=r(9524);let u},2769:function(t,e,r){function n(t){i=t.child({layer:a.er})}r.d(e,{c:function(){return n},v:function(){return i}});var a=r(5587);let i=(0,r(8327).b)("storeLogger")},9371:function(t,e,r){function n(t){return new Promise((e=>{setTimeout(e,t)}))}function a(t){const e=document.getElementById(t);e&&e.remove()}function i(t,e){const r=document.getElementById(t);r&&r.classList.remove(e)}function s(t){void 0===t&&(t=[5]),(0,nt.C)()&&"vibrate"in H.T.navigator&&H.T.navigator.vibrate(t)}function o(){const t=document.querySelector(":root");if(t){const e=document.querySelector('meta[name="theme-color"]'),r=getComputedStyle(t).getPropertyValue("--meta-theme-color").trim();e&&r&&e.getAttribute("content")!==r&&e.setAttribute("content",r)}}function c(t){const e=(0,nt.C)()&&"vibrate"in navigator;gt=function(e){e instanceof DOMException&&"NotAllowedError"===e.name||t.error({message:yt,error:e})},pt={off:()=>{ft=!0},on:()=>{ft=!1},info:t=>ft?Promise.resolve():n(0).then((()=>new Promise((e=>{ct.oR.info(t,{autoClose:5e3,hideProgressBar:!0,style:{border:"1px solid var(--info-color)",...ut},onOpen:()=>{s()},onClose:()=>{e()}})})))),warn:t=>ft?Promise.resolve():n(0).then((()=>new Promise((e=>{ct.oR.warn(t,{autoClose:!1,style:{border:"1px solid var(--warn-color)",...ut},onOpen:()=>{s()},onClose:()=>{e()}})})))),error:t=>ft?Promise.resolve():n(0).then((()=>new Promise((r=>{ct.oR.error(t,{autoClose:!1,style:{border:"1px solid var(--error-color)",...ut},onOpen:()=>{n(250).then((()=>{e?s():lt.play().catch(gt)}))},onClose:()=>{lt.pause(),r()}})})))),joyfullyGilling:t=>ft?Promise.resolve():n(0).then((()=>new Promise((e=>{ct.oR.success(t,{autoClose:5e3,hideProgressBar:!0,style:{border:"1px solid var(--success-color)",...ut},onOpen:()=>{n(250).then((()=>{lt.play().catch(gt),s([100,30,100,30,100])}))},onClose:()=>{e()}})}))))}}function d(t,e,r,n){mt=t,vt=e.child({layer:J.kA}),_t=r,Ct=n,ht=window}function u(t){return"structuredClone"in globalThis?H.T.structuredClone(t):t}function l(t){const{task_id:e,title:r,priority_id:n,category_id:a,description:i,expire_date_time:s,deleted:o=!1,completed:c=!1}=t;if(s){const t=Date.parse(s),d=new Date(t);d.setHours(0,0,0,0);return{task_id:e,title:r,priority_id:n,category_id:a,description:i,deleted:o,completed:c,expire_date_time:s,expire_date_ts:d.getTime(),expire_date_time_ts:t}}return{task_id:e,title:r,priority_id:n,category_id:a,description:i,deleted:o,completed:c,expire_date_time:void 0,expire_date_ts:void 0,expire_date_time_ts:void 0}}function g(t,e){const{tasks:r}=t;return!1===r.idsByFilterId[$t.Tl].includes(e.task_id)?{...t,tasks:{...r,idsByFilterId:{...r.idsByFilterId,[$t.Tl]:[...r.idsByFilterId[$t.Tl],e.task_id].sort(((t,e)=>(r.byId[t].expire_date_time_ts||0)-(r.byId[e].expire_date_time_ts||0)))}}}:t}function y(t,e){const{tasks:r}=t;return{...t,tasks:{...t.tasks,idsByFilterId:{...r.idsByFilterId,[$t.FR]:[...r.idsByFilterId[$t.FR],e.task_id]}}}}function f(t){return void 0!==t.expire_date_time_ts&&t.expire_date_time_ts<Date.now()}function p(t,e){const{tasks:r}=t,{idsByExpireDate:n}=r;return e.expire_date_ts?{...t,tasks:{...r,idsByExpireDate:{...n,[e.expire_date_ts]:[...n[e.expire_date_ts]||[],e.task_id].sort(((t,e)=>(r.byId[t].expire_date_time_ts||0)-(r.byId[e].expire_date_time_ts||0)))}}}:t}function k(t,e){const{tasks:r}=t;return{...t,tasks:{...t.tasks,idsByFilterId:{...r.idsByFilterId,[$t.QO]:[...r.idsByFilterId[$t.QO],e.task_id].sort(((t,e)=>(r.byId[t].expire_date_time_ts||0)-(r.byId[e].expire_date_time_ts||0)))}}}}function m(t,e){const{tasks:r}=t;return{...t,tasks:{...t.tasks,idsByFilterId:{...r.idsByFilterId,[$t.Qy]:[...r.idsByFilterId[$t.Qy],e.task_id].sort(((t,e)=>(r.byId[t].expire_date_time_ts||0)-(r.byId[e].expire_date_time_ts||0)))}}}}function v(t,e){const{tasks:r}=t;return e.category_id?{...t,tasks:{...r,idsByCategoryId:{...r.idsByCategoryId,[e.category_id]:[...r.idsByCategoryId[e.category_id]||[],e.task_id].sort(((t,e)=>(r.byId[t].expire_date_time_ts||0)-(r.byId[e].expire_date_time_ts||0)))}}}:t}function h(t,e){let r=t;return e.deleted?g(r,e):(e.category_id&&(r=v(r,e)),e.expire_date_time?(r=p(r,e),f(e)&&(r=k(r,e))):r=y(r,e),!0===e.completed&&(r=m(r,e)),r)}function _(t,e){const{tasks:r}=t;return r.idsByFilterId[$t.FR].indexOf(e.task_id)>-1?{...t,tasks:{...r,idsByFilterId:{...r.idsByFilterId,[$t.FR]:r.idsByFilterId[$t.FR].filter((t=>t!==e.task_id))}}}:t}function C(t,e){const{tasks:r}=t;return r.idsByFilterId[$t.QO].indexOf(e.task_id)>-1?{...t,tasks:{...r,idsByFilterId:{...r.idsByFilterId,[$t.QO]:r.idsByFilterId[$t.QO].filter((t=>t!==e.task_id))}}}:t}function b(t,e){const{tasks:r}=t;return r.idsByFilterId[$t.Qy].indexOf(e.task_id)>-1?{...t,tasks:{...r,idsByFilterId:{...r.idsByFilterId,[$t.Qy]:r.idsByFilterId[$t.Qy].filter((t=>t!==e.task_id))}}}:t}function I(t,e){const{tasks:r}=t;if(void 0!==e.expire_date_time&&void 0!==r.idsByExpireDate[e.expire_date_ts]){const n={...t,tasks:{...r,idsByExpireDate:{...r.idsByExpireDate,[e.expire_date_ts]:r.idsByExpireDate[e.expire_date_ts].filter((t=>t!==e.task_id))}}};if(0===n.tasks.idsByExpireDate[e.expire_date_ts].length){const{[e.expire_date_ts]:t,...r}=n.tasks.idsByExpireDate;n.tasks.idsByExpireDate=r}return n}return t}function T(t,e){const{tasks:r}=t,n=void 0!==e.category_id&&r.idsByCategoryId[e.category_id].includes(e.task_id);return e.category_id&&n?{...t,tasks:{...r,idsByCategoryId:{...r.idsByCategoryId,[e.category_id]:r.idsByCategoryId[e.category_id].filter((t=>t!==e.task_id))}}}:t}function B(t,e,r){const n=function(t,e){const{tasks:r}=t;return r.idsByFilterId[$t.Tl].indexOf(e.task_id)>-1?{...t,tasks:{...r,idsByFilterId:{...r.idsByFilterId,[$t.Tl]:r.idsByFilterId[$t.Tl].filter((t=>t!==e.task_id))}}}:t}(t,e.byId[r.task_id]);return h(n,r)}function w(t){return`${t.toLocaleDateString("ru-RU",Gt)}`}function x(t){return t.toLocaleDateString("ru-RU",{weekday:"short"})}function F(t,e,r){const n=t===r.navigationFilter.key;switch(e){case $t.p5:{const a=t,i=r.tasks.idsByFilterId[a]||Wt;return{key:t,type:e,title:$t.UB[a],altTitle:$t.hZ[a],icon_url:$t.je[a],selected:n,tasksCount:i.length}}case $t.vf:{const a=t,i=r.categories.byId[a],s=r.icons.byId[i.icon_id],o=r.tasks.idsByCategoryId[a]||Wt;return{key:t,type:e,title:i.category_name,altTitle:`Категория задач "${i.category_name}"`,icon_url:Mt.X[s.file_name],selected:n,tasksCount:o.length}}case $t.CD:{const r=t;return{key:t,type:e,title:$t.jG[r],altTitle:$t.o4[r],icon_url:$t.pd[r],selected:n,tasksCount:0}}case $t.L0:{const a=new Date(t),i=r.tasks.idsByExpireDate[t]||Wt;return{key:t,type:e,title:`${(0,Ht.Z)(x(a))}, ${w(a)}`,altTitle:"",icon_url:Mt.X["note5.png"],selected:n,tasksCount:i.length}}default:return{key:t,type:"",title:"",altTitle:"",icon_url:"",selected:!1,tasksCount:0}}}function S(t,e){if(t.error){const{error:{message:r}}=t;_t.error(e||r),vt.error(r,t.error.data)}return t}async function E(t,e){const r=Yt.getCategoryById(t);if(r.error)return S(r,"Категория не найдена");const n={...r.result,category_name:e},a=await mt.updateCategory(n);if(a.error)return S(a,`${ue} на сервере`);const i=Yt.updateCategory(n);return i.error?S(a,ue):i}function D(){(0,H.X)(window),je=rt.child({layer:J.uq}),je.info("🚀 Старт инициализации приложения"),je.debug("инициализация провайдеров"),function(t,e){ot=st(t,e)}((0,z.WL)("/api"),rt.child({layer:J.nC})),c(rt.child({layer:J.Wo}));const t=new Z.V(rt.child({layer:J.Wd})),e=new V.E(J.Aq,rt.child({layer:J.$N})),r=new at(e,rt.child({layer:J.Eo}),(()=>document.documentElement));(0,wt.c)(rt),d(ot,rt,pt,t),(0,Qe.$v)(rt.child({layer:J.UI}),pt,G,t,r)}function L(){!function(t,e){const r=document.getElementById(t);r&&r.classList.add(e)}("splash-screen","splash-screen_hidden"),setTimeout((()=>{["initialScript","colorThemeScript","resourseOnErrorScript","splashStyles","splash-screen","splashStyles"].forEach(a)}),1e3)}async function $(){H.T.utilTimers.forEach(clearTimeout),await async function(){const t=qe-(performance.now()-H.T.htmlInitTime);t>0&&await n(t)}(),a("loading-text"),i("root","Root_hidden"),L()}async function O(){je.debug("настройка приложения"),H.T.beforeInstallPromptEvent&&je.info("Приложение требует установки"),H.T.addEventListener("securitypolicyviolation",(t=>{je.error("CSP Violation Detected:",{"Blocked URI":t.blockedURI,"Violated Directive":t.violatedDirective,"Original Policy":t.originalPolicy})})),H.T.addEventListener("appinstalled",(t=>{je.info("Приложение было установлено",t)})),H.T.matchMedia("(display-mode: standalone)").addEventListener("change",(t=>{let e="browser";t.matches&&(e="standalone"),je.debug("display-mode изменился:",e)})),H.T.addEventListener("unhandledrejection",(t=>{t.preventDefault(),je.error("Unhandled promise rejection",t.reason)}))}function N(){return"serviceWorker"in H.T.navigator}function P(t){let{title:e,message:r,buttonText:n}=t;for(;document.body.firstChild;)document.body.removeChild(document.body.firstChild);const a=document.createElement("h3");if(a.textContent=e,document.body.appendChild(a),r){const t=document.createElement("p");t.textContent=r,document.body.appendChild(t)}if(n){const t=document.createElement("button");t.textContent=n,t.addEventListener("click",(()=>H.T.location.reload())),document.body.appendChild(t)}}function R(){H.T.location.reload()}function X(){return document.querySelector("#root")||function(){const t=document.createElement("div");return t.id="root",document.body.appendChild(t),t}()}async function A(){je.debug("🦚 Старт рендера приложения");const t=X();!async function(t){if(!t.result)return void je.error("Failed to create app store",t.error);const{icons:e,categories:r,priorities:n,tasks:a}=t.result;(0,xt.p)(),We.B.setEnabled(!1);try{Me(e,Yt.addIcon),Me(r,Yt.addCategory),Me(n,Yt.addPriority),Me(a,Yt.addTask)}catch(t){je.error("Initialization error",t)}We.B.setEnabled(!0)}(await async function(){return je.debug("предзагрузка данных для хранилища приложения"),ot.getTasks()}()),(0,Ke.H)(t).render((0,Ge.jsx)(Je,{}))}async function Q(t,e,r){return new H.T.Promise(((n,a)=>{t.state===e?n():t.onstatechange=async()=>{je.debug("🔥 состояние регистрции сервис-воркера",JSON.stringify({installing:r?.installing?.state,waiting:r?.waiting?.state,active:r?.active?.state},null,2)),t.state===e?n():"redundant"===t.state&&(je.debug("сервис-воркер стал не нужным."),a())}}))}function j(){!function(t,e){const r=document.getElementById(t);r&&(r.textContent=e)}(tr,"Загрузка обновлений ..."),i(tr,"loading-text_hidden")}async function q(t,e){return!(!t.waiting||"installed"!==t.waiting.state)&&(await async function(t){const e=performance.now();!t&&e<Ye&&(je.debug(`загрузка ассетов заняла меньше ${Ye} мс - отображаем индикатор загрузки`),await n(Ye-e))}(e),je.debug(`отправляем сервис-воркеру сообщение: ${J.cM}`),t.waiting.postMessage({type:J.cM}),await Q(t.waiting,"activated",t),!0)}async function U(t){if(!t||!H.T.navigator.onLine)return!1;await t.update().then((async()=>{await n(0)})),navigator.serviceWorker.addEventListener("message",er);let e=await async function(t){return!!t.installing&&(j(),je.debug("🔥🔥🔥 обнаружена новая версия сервис-воркера"),await Q(t.installing,"installed",t),!0)}(t);return e=await q(t,e),await async function(t){t.active&&(je.debug("сервис-воркер активируется"),await Q(t.active,"activated",t))}(t),!1===e&&navigator.serviceWorker.removeEventListener("message",er),e}function K(){H.T.swRegistration=void 0}async function W(){if(H.T.swRegistration){const t=await H.T.swRegistration;if(t instanceof Error)throw K(),t;const e=await U(t);return e||(await async function(){if(navigator.storage&&navigator.storage.persist&&!1===await navigator.storage.persisted()){const t=await navigator.storage.persist(),e=t?"⭐️ ":"",r=t?"дал обещание":"отверг предложение";je.debug(`${e}браузер ${r} сервис-воркеру хранить кэш персистентно`)}}(),navigator.serviceWorker.addEventListener("message",rr)),K(),e}return!1}function M(t){if(!t.message.includes(`${H.T.location.origin}/sw.js`)){if(!function(t){return navigator.serviceWorker&&null!==navigator.serviceWorker.controller&&t instanceof TypeError&&t.message.startsWith("Failed to update a ServiceWorker for scope")}(t))throw t;je.error("Не удалось обновить сервис-воркер")}}var G={};r.r(G),r.d(G,{addCategory:function(){return re},addIcon:function(){return te},addPriority:function(){return ee},addTask:function(){return le},clearTasks:function(){return Ie},clearTrash:function(){return ye},createCategory:function(){return ne},createTask:function(){return pe},deleteCategory:function(){return ie},deleteTask:function(){return me},exportTasks:function(){return be},importTasks:function(){return we},renameCategory:function(){return E},setNavigationFilterByCategoryId:function(){return Ee},setNavigationFilterByDate:function(){return xe},setNavigationFilterByFilterId:function(){return Fe},setNavigationFilterByOthersId:function(){return Se},undeleteTask:function(){return Ce},updateCategory:function(){return oe},updateCategoryIcon:function(){return de},updateTask:function(){return he},useAppStateJsonString:function(){return Oe},useCalendarDate:function(){return Pe},useCategoryById:function(){return $e},useCategoryIconList:function(){return Ae},useCategoryList:function(){return Le},useNavItem:function(){return De},useNavigationFilter:function(){return Ne},useTaskItem:function(){return Xe},useTaskList:function(){return Re}});var H=r(6835),V=r(9324),Z=r(9755),z=r(1232),J=r(5587),Y=(r(3788),r(6565)),tt=r(7270);const et=t=>(0,tt.o)(`Попытка обратиться к неинициализированному сервису ${t}`);let rt=et("logger");rt=new Y.X("/log");var nt=r(5789);class at{intervalId=null;constructor(t,e,r){this.kvStore=t,this.logger=e,this.elementSelector=r,this.mediaQueryList=H.T.matchMedia("(prefers-color-scheme: dark)"),this.mediaQueryList.addEventListener("change",this.handleColorSchemeChange),this.handleColorSchemeChange({matches:this.mediaQueryList.matches})}async setColorScheme(t){await this.kvStore.setItem(J.ux,t),this.handleColorSchemeChange({matches:this.mediaQueryList.matches}),s()}async getColorScheme(){return this.kvStore.getItem(J.ux)}startProcess=()=>{null===this.intervalId&&(this.intervalId=setInterval((()=>{this.handleIntervalChecks()}),J.CK))};stopProcess=()=>{null!==this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)};handleIntervalChecks=async()=>{const t=this.elementSelector();if(!t)return;const{classList:e}=t,r=await this.kvStore.getItem(J.ux),{themeByTime:n=J.XT,since:a=J.AH,to:i=J.$v}=r;if(r.theme===J.XL){const t=function(t,e){const r=new Date,n=new Date,a=new Date;if(n.setHours(parseInt(t.split(":")[0],10),parseInt(t.split(":")[1],10),0,0),a.setHours(parseInt(e.split(":")[0],10),parseInt(e.split(":")[1],10),0,0),e<t){const t=new Date(r);t.setDate(t.getDate()+1),a.setDate(a.getDate()+1),r<n?(n.setDate(n.getDate()-1),a.setDate(a.getDate()-1)):r>=t&&(n.setDate(n.getDate()+1),a.setDate(a.getDate()+1))}return r>=n&&r<a}(a,i);t?(e.contains(J.BB)&&n!==J.BB&&e.remove(J.BB),e.contains(J.XT)&&n!==J.XT&&e.remove(J.XT),e.add(n)):this.mediaQueryList.matches?(e.add(J.XT),e.remove(J.BB)):(e.remove(J.XT),e.remove(J.BB))}else e.remove(n);o()};handleColorSchemeChange=async t=>{this.stopProcess();const e=this.elementSelector();if(!e)return;const{classList:r}=e,n=t.matches?"dark":"light",{theme:a}=await this.kvStore.getItem(J.ux),i=[J.XT,J.BB,J.XL].find((t=>t===a));i?(J.yK.includes(i)&&(i===J.BB?r.remove(J.XT):r.remove(J.BB),r.add(i)),i===J.XL&&(await this.handleIntervalChecks(),this.startProcess())):(r.remove(J.BB),n===J.XT?r.add(J.XT):r.remove(J.XT)),o()};destroy(){this.stopProcess(),this.mediaQueryList.removeEventListener("change",this.handleColorSchemeChange)}}var it=r(2292);const st=(t,e)=>new Proxy({},{get(e,r){return async e=>{const n=(0,it.Z)(),a=r.replace(/([A-Z])/g,(t=>`_${t.toLowerCase()}`));return t({body:{id:n,method:a,params:e}})}}});let ot=et("api");var ct=r(2845),dt=r.p+"error.8ad17092b67f41ed6f08.mp3";const ut={lineHeight:1.45,color:"var(--text-color)",fontFamily:"inherit",backgroundColor:"var(--notify-surface-color)"},lt=new Audio(dt);let gt;lt.preload="auto",lt.volume=.25;const yt="Ошибка воспроизведения звука";let ft=!1,pt=et("notify");var kt=r(8327);let mt=(0,kt.b)("api"),vt=(0,kt.b)("logger"),ht=(0,kt.b)("browser"),_t=(0,kt.b)("notify"),Ct=(0,kt.b)("storage");var bt=r(6539),It=r(2069),Tt=r(4248),Bt=r(9914),wt=r(2769),xt=r(1264);const Ft=t=>Object.values(t.icons.byId);var St=r(3702);const Et=t=>{const e=(0,St.A)(t);if(e.error){const{message:t,data:r}=e.error;return wt.v.error(t,r),e}const r=e.result,n=xt.C.getState(),a=function(t,e){const{category_id:r}=e;return{...t,tasks:{...t.tasks,idsByCategoryId:{...t.tasks.idsByCategoryId,[r]:[]}}}}(n,r);return a!==n&&xt.C.setState(a),{result:r}};var Dt=r(4230);var Lt=r(8787),$t=r(1969);const Ot=t=>{const e=(0,Lt.X)(t);if(e.error)return e;const r=e.result,n=xt.C.getState(),a=h(n,l(r));return n!==a&&xt.C.setState(a),{result:r}};var Nt=r(2677),Pt=r(7730),Rt=r(9046);const Xt=t=>{const e=xt.C.getState().tasks;if(!1===function(t,e){const r=(0,Nt.b)((0,$t.gg)(t),{...(0,$t.gg)(e),deleted:!0});return void 0!==t&&void 0!==e&&!0===r&&!0===t.deleted&&!e.deleted}(t.task_id&&e.byId[Number(t.task_id)]||{},t)){const e={message:`${Xt.name}: задача не найдена`,data:t};return wt.v.error(e.message,e.data),{error:e}}const r=(0,Rt.l)({...t,deleted:!1});if(r.error)return r;const n=r.result,a=xt.C.getState(),i=B(a,e,l(n));return i!==a&&xt.C.setState(i),{result:n}};var At=r(143);const Qt="Файл не содержит данных для импорта";var jt=r(836);const qt=t=>qt(t);var Ut=r(9524);var Kt=r(6540);const Wt=[];var Mt=r(4183);const Gt={year:"numeric",month:"long",day:"numeric"};var Ht=r(9329);const Vt=t=>t.categories.ids,Zt=t=>{const{key:e,type:r}=t.navigationFilter;return F(e,r,t)};var zt=r(648);const Jt=t=>{const{key:e,type:r}=t.navigationFilter;switch(r){case $t.L0:return t.tasks.idsByExpireDate[e]||Wt;case $t.p5:return t.tasks.idsByFilterId[e]||Wt;case $t.vf:return t.tasks.idsByCategoryId[e]||Wt;default:return Wt}},Yt={addIcon:bt.X,useCategoryIconList:()=>u((0,xt.C)((0,Bt.k)(Ft))),addCategory:Et,deleteCategory:t=>{const e=(0,Dt.K)(t);if(e.error){const{message:t,data:r}=e.error;return wt.v.error(t,r),e}const r=e.result,n=xt.C.getState(),a=function(t,e){const{category_id:r}=e,{[r]:n,...a}=t.tasks.idsByCategoryId;return{...t,tasks:{...t.tasks,idsByCategoryId:a}}}(n,r);return a!==n&&xt.C.setState(a),{result:r}},updateCategory:It.s,getCategoryById:t=>{const e=xt.C.getState().categories.byId[t];return e?{result:e}:{error:{code:500,message:"Категория не найдена",data:{id:t}}}},getLastCategory:()=>{const t=xt.C.getState(),e=t.categories.ids.at(-1);return e?{result:t.categories.byId[e]}:{error:{code:500,message:"Категории не найдены"}}},addPriority:Tt.m,createCalendarNavigationFilter:Ut.r,createCategoryNavigationFilter:t=>(0,$t.Tz)(t),createFilterNavigationFilter:t=>(0,$t.x7)(t),createOthersNavigationFilter:qt,setNavigationFilter:jt.n,addTask:Ot,trashTask:function(t){const e=xt.C.getState(),{[Number(t.task_id)]:r,...n}=e.tasks.byId,a={...e,tasks:{...e.tasks,byId:n,ids:e.tasks.ids.filter((e=>e!==t.task_id)),idsByFilterId:{...e.tasks.idsByFilterId,[$t.Tl]:e.tasks.idsByFilterId[$t.Tl].filter((e=>e!==t.task_id))}}};return e!==a&&xt.C.setState(a),{result:t}},deleteTask:t=>{const e=xt.C.getState().tasks,r=t.task_id&&(0,Pt.gg)(e.byId[t.task_id]);if(!(0,Nt.b)((0,Pt.gg)(t),r)){const e={message:"Задача не найдена",data:t};return wt.v.error(e.message,e.data),{error:e}}const n=(0,Rt.l)({...t,deleted:!0});if(n.error){const{message:t,data:e}=n.error;return wt.v.error(t,e),n}const a=n.result,i=xt.C.getState(),s=function(t,e,r){let n=t;return function(t,e){return t&&!t.deleted&&!0===e.deleted}(e.byId[r.task_id],r)&&(n=T(n,r),n=I(n,r),n=_(n,r),n=C(n,r),n=b(n,r),n=g(n,r)),n}(i,e,l(a));return s!==i&&xt.C.setState(s),{result:a}},undeleteTask:Xt,updateTask:t=>{const{task_id:e}=t;let r=xt.C.getState();const n=r.tasks;if(e&&!0===n.byId[e].deleted){const e={message:"Нельзя обновить удаленную задачу",data:t};return wt.v.error(e.message,e.data),{error:e}}const a=(0,Rt.l)(t);if(a.error){const{message:t,data:e}=a.error;return wt.v.error(t,e),a}const i=a.result;r=xt.C.getState();const s=function(t,e,r){const n=e.byId[r.task_id];let a=t;return function(t,e){return void 0===t.category_id&&void 0!==e.category_id}(n,r)&&(a=v(a,r)),function(t,e){return void 0!==t.category_id&&void 0===e.category_id}(n,r)&&(a=T(a,n)),function(t,e){return t.category_id!==e.category_id}(n,r)&&(a=T(a,n),a=v(a,r)),function(t,e){return void 0===t.expire_date_time&&void 0!==e.expire_date_time}(n,r)&&(a=_(a,n),a=p(a,r),f(r)&&(a=k(a,r))),function(t,e){return void 0!==t.expire_date_time&&void 0===e.expire_date_time}(n,r)&&(a=I(a,n),a=C(a,r),a=y(a,r)),function(t,e){return void 0!==t.expire_date_time&&void 0!==e.expire_date_time&&t.expire_date_time!==e.expire_date_time}(n,r)&&(a=I(a,n),a=C(a,r),a=p(a,r),f(r)&&(a=k(a,r))),a=function(t,e){return!0===e.completed&&t.completed!==e.completed}(n,r)?m(a,r):b(a,r),a}(r,n,l(i));return s!==r&&xt.C.setState(s),{result:i}},exportTasks:()=>{const t=xt.C.getState();return{tasks:Object.values(t.tasks.byId).map((t=>(0,Pt.gg)(t))),categories:Object.values(t.categories.byId)}},clearTasks:()=>{const t=xt.C.getState().tasks.byId,e=u(Object.values(t));for(const[e,r]of Object.entries(t)){const t=(0,At.v)(r);if(t.error)return{error:t.error}}const r=xt.C.getState(),n=r.categories.ids.reduce(((t,e)=>({...t,[e]:[]})),{}),a={...r,tasks:{...r.tasks,idsByExpireDate:[],idsByCategoryId:n,idsByFilterId:{[$t.FR]:[],[$t.Tl]:[],[$t.QO]:[],[$t.Qy]:[]}}};return xt.C.setState(a),{result:e}},importTasks:t=>{if(!("categories"in t)||!("tasks"in t))return wt.v.error(Qt,t),{error:{message:Qt,data:t}};const{categories:e,tasks:r}=t;return e.forEach((t=>{Et(t)})),r.forEach((t=>{Ot(t)})),{result:t}},getTasksInTrash:function(){const t=xt.C.getState();return t.tasks.idsByFilterId[$t.Tl].map((e=>t.tasks.byId[e]))},useAppStateJsonString:t=>{const e=(0,Kt.useCallback)((e=>JSON.stringify(e,null,t)),[t]);return(0,xt.C)(e)},useNavItem:(t,e)=>{const r=(0,Kt.useCallback)((r=>F(t,e,r)),[t,e]);return u((0,xt.C)((0,Bt.k)(r)))},useCategoryList:()=>u((0,xt.C)(Vt)),useCategoryById:t=>(0,xt.C)((e=>e.categories.byId[t])),useNavigationFilter:()=>u((0,xt.C)((0,Bt.k)(Zt))),useCalendarDate:t=>{const e=(0,zt.g)(t),r=Kt.useCallback((t=>({selected:t.navigationFilter.type===$t.L0&&t.navigationFilter.key===e,tasks:t.tasks.idsByExpireDate[e]?.length||0})),[e]);return(0,xt.C)((0,Bt.k)(r))},useTaskList:()=>u((0,xt.C)(Jt)),useTaskItem:t=>{const e=(0,Kt.useCallback)((e=>e.tasks.byId[t]),[t]);return u((0,xt.C)(e))}},te=t=>S(Yt.addIcon(t),"Ошибка добавления иконки"),ee=t=>S(Yt.addPriority(t),"Ошибка добавления приоритета"),re=t=>S(Yt.addCategory(t),"Ошибка при добавлении категории"),ne=async t=>{const e=await mt.createCategory(t);if(e.error)return S(e,`Сервер:${e.error.message}`);return Yt.addCategory(e.result).error?S(e,"Ошибка создания новой категории"):e},ae="Ошибка удаления категории",ie=async t=>{const e=Yt.getCategoryById(t);if(e.error)return S(e,"Категория не найдена");const r=e.result,n=await mt.deleteCategory(r);if(n.error)return S(n,`${ae} на сервере`);const a=Yt.deleteCategory(n.result);if(a.error)return S(n,ae);const i=Yt.getLastCategory();if(i.result){const t=Yt.createCategoryNavigationFilter(i.result.category_id);Yt.setNavigationFilter(t)}else{const t=Yt.createCalendarNavigationFilter(new Date);Yt.setNavigationFilter(t)}return a},se="Ошибка обновления категории",oe=async t=>{const e=await mt.updateCategory(t);if(e.error)return S(e,`${se} на сервере`);const r=Yt.updateCategory(e.result);return r.error?S(e,se):r},ce="Ошибка обновления иконки категории",de=async(t,e)=>{const r=Yt.getCategoryById(t);if(r.error)return S(r,"Категория не найдена");const n={...r.result,icon_id:e},a=await mt.updateCategory(n);if(a.error)return S(a,`${ce} на сервере`);const i=Yt.updateCategory(n);return i.error?S(a,ce):i},ue="Ошибка переименования категории",le=t=>S(Yt.addTask(t),"Ошибка добавления задачи"),ge="Ошибка очистки корзины",ye=async()=>{const t=await Promise.all(Yt.getTasksInTrash().map((async t=>{const e=await mt.deleteTask(t);e.error&&vt.error(`${ge} на сервере`,e.error.data);const r=Yt.trashTask(t);return r.error&&vt.error(ge,r.error.data),r})));return t.find((t=>t.error))&&_t.error(ge),t},fe="Ошибка создания задачи",pe=async t=>{const e=await mt.createTask(t);if(e.error)return S(e,`${fe} на сервере`);const r=Yt.addTask(e.result);return r.error?S(e,fe):r},ke="Ошибка удаления задачи",me=async t=>{const e=await mt.deleteTask(t);if(e.error)return S(e,`${ke} на сервере`);const r=Yt.deleteTask(e.result);return r.error?S(e,ke):r},ve="Ошибка обновления задачи",he=async t=>{const e=await mt.updateTask(t);if(e.error)return S(e,`${ve} на сервере`);const r=Yt.updateTask(e.result);return r.error?S(e,ve):r},_e="Ошибка восстановления задачи из корзины",Ce=async t=>{const e=await mt.updateTask({...t,deleted:!1});if(e.error)return S(e,`${_e} на сервере`);const r=Yt.updateTask(e.result);return r.error?S(e,_e):r},be=()=>u(Yt.exportTasks()),Ie=async()=>{const t=await mt.clearTasks();return t.error?S(t,"Ошибка удаления всех задач на сервере"):(Yt.clearTasks(),_t.info("Все задачи удалены"),{result:J.Ok})},Te="Файл не содержит данных для импорта",Be="Не удалось очистить задачи: ",we=async function(t,e){if(void 0===e&&(e=!1),!("categories"in t)||!("tasks"in t))return _t.error(Te),vt.error(Te,t),{error:{message:Te,data:t}};if(e){const t=await mt.clearTasks();if(t.error)return _t.error(`${Be}${t.error.message}`),t}const{categories:r,tasks:n}=t,a=await mt.importTasks({categories:r,tasks:n});if(a.error)return _t.error(`${Be}${a.error.message}`),a;const i=a.result.imported;if(i.categories.length>0||i.tasks.length>0){const t=Yt.importTasks(a.result.imported);if(t.error)return _t.error(`${Be}${t.error.message}`),t}return _t.info(`${a.result.imported.tasks.length} задач(и) импортировано`),a},xe=t=>{const e=Yt.createCalendarNavigationFilter(t);Yt.setNavigationFilter(e)},Fe=t=>{const e=Yt.createFilterNavigationFilter(t);Yt.setNavigationFilter(e)},Se=t=>{const e=Yt.createOthersNavigationFilter(t);Yt.setNavigationFilter(e)},Ee=t=>{const e=Yt.createCategoryNavigationFilter(t);Yt.setNavigationFilter(e)},De=(t,e)=>Yt.useNavItem(t,e),Le=()=>Yt.useCategoryList(),$e=t=>Yt.useCategoryById(t),Oe=t=>Yt.useAppStateJsonString(t),Ne=()=>Yt.useNavigationFilter(),Pe=t=>Yt.useCalendarDate(t),Re=()=>Yt.useTaskList(),Xe=t=>Yt.useTaskItem(t),Ae=()=>Yt.useCategoryIconList();var Qe=r(111);let je=et("appLogger");const qe=1e3;class Ue extends Error{constructor(t){void 0===t&&(t="Сервис-воркер не поддерживается"),super(t),this.name="NoServiceWorkerError",Object.setPrototypeOf(this,Ue.prototype)}}var Ke=r(5338),We=r(5480);const Me=(t,e)=>{t.forEach((t=>{const r=e(t);r.error&&je.error(r.error.message,t)}))};var Ge=r(4848);const He={padding:"var(--x4)",inlineSize:"100%"};var Ve=function(t){let{pageReload:e}=t;return(0,Ge.jsxs)("div",{style:He,children:[(0,Ge.jsx)("p",{children:"Произошла ошибка загрузки приложения"}),(0,Ge.jsx)("button",{type:"button",onClick:e,children:"Перезагрузить страницу"})]})};const Ze=(0,Kt.memo)((()=>(0,Ge.jsx)(Ve,{pageReload:R})));Ze.displayName="FailedLoadingAppContainer";var ze=Ze;var Je=(0,Kt.lazy)((()=>Promise.all([r.e(425),r.e(524)]).then(r.bind(r,4685)).catch((t=>(je.error("Ошибка загрузки компонента App",t),{default:ze})))));const Ye=1e3,tr="loading-text",er=t=>{t.data.type===J.K$&&(je.debug(`получили сообщение от сервис-воркера ${J.K$} - перезагружаем страницу`),R())},rr=t=>{je.debug("получили сообщение от сервис-воркера",t.data),We.B.apply((()=>{switch(t.data.type){case J.oQ:Yt.addCategory(t.data.data);break;case J.FS:Yt.updateCategory(t.data.data);break;case J.d5:Yt.deleteCategory(t.data.data);break;case J.v6:Yt.addTask(t.data.data);break;case J.c1:Yt.updateTask(t.data.data);break;case J.Cj:Yt.deleteTask(t.data.data);break;case J.dR:Yt.clearTasks();break;case J.tC:Yt.importTasks(t.data.data)}}))};!async function(){D();try{!1===await async function(){je.debug("настройка сервис-воркера...");let t=!1;if(!N())throw je.debug("сервис-воркер не поддерживается"),new Ue;je.debug("сервис-воркер поддерживается");try{t=await W()}catch(t){M(t)}return t}()&&(await O(),await A(),await $())}catch(t){!function(t){if(je.error("ошибка при инициализации приложения",t),t instanceof Ue)N()?P({title:"Установка завершилась ошибкой",message:"удостовертесь в наличие сети и попробуте еще раз.",buttonText:"Перезагрузить страницу"}):P({title:"К сожалению, ваш браузер не поддерживает service worker!",message:"Попробуйте другой браузер или обновите данный браузер до последней версии."});else{if(t instanceof Error&&"Error"===t.name)return;P({title:"Произошла ошибка при инициализации приложения!",buttonText:"Перезагрузить страницу"})}}(t)}}()},4183:function(t,e,r){r.d(e,{X:function(){return C}});var n=r.p+"alert.476b00abda902b398be7.png",a=r.p+"ball.3d996bafa729a1d3f580.png",i=r.p+"bug.83b52ad3ded9ef1fbd18.png",s=r.p+"cart.2d640112b4b86b627ff7.png",o=r.p+"favorite.7f0174c25660ef72df60.png",c=r.p+"home.3e40fe2b97b19c75dfaf.png",d=r.p+"inbox.58a834f614e341f9c578.png",u=r.p+"life.5896aaa56394aa0273b3.png",l=r.p+"mail.4a4239588f1b0d37bcfc.png",g=r.p+"other.66c872e04e2846cafa68.png",y=r.p+"page.9d1fc4484b1e5929b7ee.png",f=r.p+"today.141e3d87afbd71da541c.png",p=r.p+"twitter.5556cda0273e796d6a65.png",k=r.p+"warning.4f48c087dcbbdb3bd268.png",m=r.p+"folder_red.66f2d7c840bd3b9aed95.png",v=r.p+"next.4b695e6dc3fabdcc84b4.png",h=r.p+"note.8e112a51a84fa9c09b11.png",_=r.p+"note5.abc5ade9f6cd6928e96d.png";const C={"alert.png":n,"ball.png":a,"bug.png":i,"cart.png":s,"favorite.png":o,"home.png":c,"inbox.png":d,"life.png":u,"mail.png":l,"other.png":g,"page.png":y,"today.png":f,"twitter.png":p,"warning.png":k,"folder_red.png":m,"next.png":v,"note.png":h,"refresh.png":r.p+"refresh.7c9f0768269a6bbec081.png","trash.gif":r.p+"trash.3e03c195726c2cccdc94.gif","expired.svg":r.p+"expired.45d759abb485d88b78aa.svg","settings.svg":r.p+"settings.231ef2d68a51da6cad41.svg","state.svg":r.p+"state.c56984d48249544ade49.svg","help.svg":r.p+"help.83136d93df7a9872ae11.svg","share.svg":r.p+"share.ffc5f2b689d17d39785e.svg","note5.png":_}},5789:function(t,e,r){function n(){return a.T.matchMedia("(hover: none) and (pointer: coarse)").matches}r.d(e,{C:function(){return n}});var a=r(6835)},5587:function(t,e,r){r.d(e,{$N:function(){return d},$v:function(){return $},AH:function(){return L},Aq:function(){return F},BB:function(){return T},CK:function(){return E},CZ:function(){return D},Cj:function(){return _},Eo:function(){return u},FS:function(){return k},K$:function(){return y},Ok:function(){return n},UI:function(){return a},Wd:function(){return l},Wo:function(){return c},XL:function(){return w},XT:function(){return I},c1:function(){return h},cM:function(){return f},d5:function(){return m},dR:function(){return C},er:function(){return o},kA:function(){return g},nC:function(){return s},oQ:function(){return p},qU:function(){return B},tC:function(){return b},uq:function(){return i},ux:function(){return S},v6:function(){return v},yK:function(){return x}});const n="Ok",a="[ UI ]",i="[ APP ]",s="[ API ]",o="[ STORE ]",c="[ NOTIFY ]",d="[ KV-STORE ]",u="[ THEME ]",l="[ LOCAL-STORAGE ]",g="[ USE-CASES ]",y="RELOAD_PAGE",f="SKIP_WAITING",p="create_category",k="update_category",m="delete_category",v="create_task",h="update_task",_="delete_task",C="clear_tasks",b="import_tasks",I="dark",T="light",B="system",w="byTime",x=["dark","light"],F="kv-storage",S="colorSchema",E=3e4,D=864e5,L="20:00",$="07:00"},648:function(t,e,r){function n(t){return t.setHours(0,0,0,0),t.getTime()}r.d(e,{g:function(){return n}})},6835:function(t,e,r){function n(t){a=t}r.d(e,{T:function(){return a},X:function(){return n}});let a=(0,r(8327).b)("browser")},9329:function(t,e,r){function n(t){return t[0].toUpperCase()+t.slice(1)}r.d(e,{Z:function(){return n}})},8327:function(t,e,r){r.d(e,{b:function(){return a}});var n=r(7270);const a=t=>(0,n.o)(`Попытка обратиться к неинициализированному DI сервиса ${t}`)}},function(t){t.O(0,[425,12,644],(function(){return e=9371,t(t.s=e);var e}));t.O()}]);