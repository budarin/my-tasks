!function(){"use strict";const t=self,e=200,a=206,n="assets",s="Content-Security-Policy";const r="/api/",i="get_tasks",o={"Content-Type":"application/json; charset=utf-8"},c="RELOAD_PAGE",d="create_category",u="update_category",l="delete_category",f="create_task",g="update_task",y="delete_task",p=[d,u,l,f,g,y];const m="tasks",_="kv-storage";async function h(t){if(t.icons&&t.icons.length>0){let e;const a=JSON.stringify(t),n=await caches.open(_),s=await n.match(m);void 0!==s&&(e=await s.text()),void 0!==s&&e===a||await n.put(m,new Response(a,{headers:new Headers({...o,"Content-Length":String(a.length)})}))}}let w={tasks:[],categories:[],priorities:[],icons:[]};function k(){return w}async function b(t){w=t,await h(t)}function v(t){const e=new Date;return e.setDate(e.getDate()+t),e.toISOString()}const S={icons:[{icon_id:1,file_name:"page.png"},{icon_id:2,file_name:"home.png"},{icon_id:3,file_name:"other.png"},{icon_id:4,file_name:"warning.png"},{icon_id:5,file_name:"alert.png"},{icon_id:6,file_name:"ball.png"},{icon_id:7,file_name:"bug.png"},{icon_id:8,file_name:"cart.png"},{icon_id:9,file_name:"favorite.png"},{icon_id:10,file_name:"inbox.png"},{icon_id:11,file_name:"life.png"},{icon_id:12,file_name:"mail.png"},{icon_id:13,file_name:"twitter.png"},{icon_id:14,file_name:"note.png"}],priorities:[{priority_id:1,priority_name:"низкий",color:"#808080"},{priority_id:2,priority_name:"нормальный",color:"#000000"},{priority_id:3,priority_name:"повышенный",color:"#008000"},{priority_id:4,priority_name:"высокий",color:"#E56353"}],categories:[{category_id:1,icon_id:3,category_name:"Работа"},{category_id:2,icon_id:2,category_name:"Дом"},{category_id:3,icon_id:6,category_name:"Здоровье"},{category_id:4,icon_id:7,category_name:"Фигня"}],tasks:[{task_id:1,priority_id:1,category_id:1,title:"Todo1",deleted:!1},{task_id:2,priority_id:2,category_id:2,title:"Hover your mouse over a project or item and click the icon on the right side of the item for more",due_date_time:v(-1)},{task_id:3,priority_id:3,category_id:3,title:"Todo3",due_date_time:function(t){const e=new Date;return e.setMinutes(e.getMinutes()+t),e.toISOString()}(1)},{task_id:4,priority_id:4,category_id:1,title:"Todo4",due_date_time:v(1),completed:!0,deleted:!1},{task_id:5,priority_id:4,title:"Todo5"},{task_id:6,category_id:4,priority_id:4,title:"Todo6",completed:!0,deleted:!1},{task_id:7,priority_id:2,title:"Todo7",completed:!0,deleted:!0}]};async function T(){let t=k();const e=await caches.open(_),a=await e.match(m);if(t.icons&&0===t.icons.length){if(void 0!==a){const e=await a.json();if(e)return t=e,await b(t),t}if(t.icons&&0===t.icons.length)return await b(S),S}return a||await h(t),t}async function x(){await async function(){const e=await caches.open(n);let a=(await e.keys()).map((t=>new URL(t.url).pathname));const s=a.filter((e=>!t.assets.includes(e)));s.length>0&&await Promise.all(s.map((async t=>{await e.delete(t),a=a.filter((e=>e!==t))})));const r=t.assets.filter((t=>!a.includes(t)));r.length>0&&await e.addAll(r)}(),await T(),await async function(){t.clients.matchAll().then((t=>{t.forEach((t=>t.postMessage({type:c})))}))}()}const j=()=>{};let q=new Proxy({},{get:()=>j});const R=["/my-tasks/alert.png","/my-tasks/android-chrome-192x192.1cfc30bbcbf340fc741d.png","/my-tasks/android-chrome-512x512.558e975c145ffb2a28fd.png","/my-tasks/android-chrome-maskable-192x192.126708023a549b771f76.png","/my-tasks/android-chrome-maskable-512x512.d40a692f812ed7f5e7e3.png","/my-tasks/app.50185fe91c72b5c9c2bd.js","/my-tasks/apple-touch-icon.7cb6aa9a5fc2e73f0df5.png","/my-tasks/ball.png","/my-tasks/budarin.4a1954bad283653e8db0.js","/my-tasks/bug.png","/my-tasks/cart.png","/my-tasks/error.8ad17092b67f41ed6f08.mp3","/my-tasks/favicon-32x32.88ac8115acd8f90a85e8.png","/my-tasks/favicon.31159ba4d345a313888e.ico","/my-tasks/favorite.png","/my-tasks/film.png","/my-tasks/folder_red.png","/my-tasks/home.png","/my-tasks/icon.cd3261e56180c2c0e031.svg","/my-tasks/inbox.png","/my-tasks/life.png","/my-tasks/mail.png","/my-tasks/main.beb7bf5e2ac1ed6f9d11.js","/my-tasks/next.png","/my-tasks/note.png","/my-tasks/note5.png","/my-tasks/npms.03b680477565bc10ec71.js","/my-tasks/other.png","/my-tasks/overdue.svg","/my-tasks/page.png","/my-tasks/react.072e730091aa92f00ee4.js","/my-tasks/refresh.png","/my-tasks/roboto-regular-webfont.7c365dca831ccd4122ac.woff2","/my-tasks/runtime.7e523ab703ed8161371b.js","/my-tasks/today.png","/my-tasks/trash.gif","/my-tasks/twitter.png","/my-tasks/warning.png","/my-tasks/manifest.2f157314e5da1bc3c97a335d75e64f38.webmanifest","/my-tasks/offline.b8fea3f99e934cbab2ea4229032f2000.html"];function O(t){}function E(t,e,a){return new Response(JSON.stringify({id:t,error:{code:500,message:e,data:a}}),{headers:o,status:200})}function I(){return navigator.userAgent.toLowerCase().includes("chrome")||navigator.userAgent.toLowerCase().includes("chromium")}const W="/my-tasks/",L=t=>t.startsWith(`${W}offline.`)&&t.endsWith(".html"),$="default-src 'none'; base-uri 'none'; object-src 'none'; connect-src 'self'; media-src 'self'; manifest-src 'self'; img-src 'self' data: ; worker-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'sha384-8ZqEQ3vxgir9Bi_y0Lz_vl31q-W_p-YvbSbIRoH8jZLOxdM0k5tqSc2-3h_DSHKp' 'sha384-Ul13hXxd26CuGKdSBqjdxgWgvOJ0LujQd8PL_Qms8nl8pC94Ey-zBvlEhpvMv9Na' 'sha384-2WZPK9bOk-gNZ-Z8eKZbUPTzTOgw5OrAYWl8epa74e2o9NSBRq32eXWfEnKLR9M9' 'sha384-xnWWkOTSvPAuspyBC92de_b4xZpLVwU4ZWtyeBuEHz3DqExMpCkH-aykTvk1EfrZ' 'sha384-solIkdQ9Ndyu9exc1iU0J4TTEcZJdLGyvfj_0MfrLHGohPRSWFqhRafBh_e-3Z_V' 'sha384-mKvTpL5idEXA_pmfTavsSTwY_Uah7A3pfb4TYz__AZS7QGb_hHaECOKTmuiKgwYB' 'sha384-WyMejg2syC6wdMFFKrJnnxRCCHnLCgAPCyB5TwE0erVX4eTEbvc1reyqnemStZWp' 'sha384-fB1BrtQsOTVSUZKmp0JiuVjCU82aVVO8y_4Gtohg6sIDkcZd5gEk-gI8cjOCkXiV' 'unsafe-inline'; font-src 'self' data:; require-trusted-types-for 'script'; trusted-types webpack-tt default;";async function A(r,i,o){const c=await caches.open(n),d=await c.match(i);if(d){if(L(i)&&!d.headers.get(s)){const t=d.clone(),e=new Headers(d.headers);e.set(s,$);try{let a=await d.text();I()&&(a=a.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""));const n=new Response(a,{status:t.status,statusText:t.statusText,headers:e});return await c.put(i,n.clone()),n}catch(t){return d}}return d}return async function(r,i){let o;const c=await fetch(r);if(null===c.body)return c;const d=new Headers(c.headers);if(c.status===a){const t=await c.blob(),e=await t.arrayBuffer();o=new Response(e,{headers:d})}else{let t;L(r)?(t=await c.text(),d.set(s,$),I()&&(t=t.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""))):t=await c.blob(),o=new Response(t,{headers:d,status:c.status,statusText:c.statusText})}const u=o.status===e;if(!1===u)return c;u&&t.assets.includes(i)&&(await caches.open(n)).put(r,o.clone());return o}(i,o)}function C(t){void 0===t&&(t=Date.now());const e=new Uint8Array(10);!function(t){if(void 0!==globalThis.crypto&&"function"==typeof globalThis.crypto.getRandomValues)return globalThis.crypto.getRandomValues(t);if("function"==typeof require){const e=require("crypto").randomBytes(t.length);return t.set(e),t}throw new Error("Secure random number generation is not supported in this environment.")}(e);const a=t.toString(16).padStart(12,"0"),n=function(t){let e="";for(let a=0;a<t.length;a++){const n=t[a].toString(16);e+=2===n.length?n:"0"+n}return e}(e);return`${a.substring(0,8)}-${a.substring(8)}-${n.substring(0,4)}-${n.substring(4,8)}-${n.substring(8)}`}function Z(t){return"number"==typeof t&&Number.isInteger(t)}const U=(t,e)=>`Свойство сущности ${t} "${e}" должно быть целым числом`;function N(t,e){return void 0===e&&(e=65536),a=>"string"==typeof a&&a.length>=t&&a.length<=e}const B=(t,e,a,n)=>`Свойство сущности ${t} "${e}" должно быть строкой длиной от ${a} до ${n} символов`;const P=(t,e,a,n)=>{if(!1===function(t){return"object"==typeof t&&null!==t}(t))return{error:{message:`Сущность "${n}" должна быть объектом`,data:t}};const s=t,r=Object.keys(e);for(let a=0;a<r.length;a++){const i=r[a],o=e[i];if(!0===o.required&&void 0===s[i])return{error:{message:`Свойство "${i}" сущности ${n} отсутствует`,data:t}};for(let e=0;e<o.validators.length;e++){const a=o.validators[e];if(!1===a[0](s[i]))return{error:{message:a[1],data:t}}}}return{result:a(s)}};function H(t){const{icon_id:e,category_name:a}=t||{};return{icon_id:e,category_name:a}}const J="Категория",K={icon_id:{validators:[[Z,U(J,"icon_id")]],required:!0},category_name:{validators:[[N(3,20),B(J,"category_name",3,20)]],required:!0}},M=t=>P(t,K,H,J);function V(t){const{category_id:e,icon_id:a,category_name:n}=t||{};return{category_id:e,icon_id:a,category_name:n}}const D={category_id:{validators:[[Z,U(J,"category_id")]],required:!0},...K},G=t=>P(t,D,V,J);function Q(t){return e=>void 0===e||t(e)}function z(t){return"boolean"==typeof t}function X(t,e){return`Свойство сущности ${t} "${e}" должно быть undefined или boolean`}function Y(t){const{title:e,priority_id:a,category_id:n,description:s,due_date_time:r,deleted:i,completed:o}=t||{};return{title:e,priority_id:a,category_id:n,description:s,due_date_time:r,deleted:i,completed:o}}const F="Задача",tt={title:{validators:[[N(3,100),B(F,"title",3,100)]],required:!0},priority_id:{validators:[[Z,U(F,"priority_id")]],required:!0},category_id:{validators:[[Q(Z),function(t,e){return`Свойство сущности ${t} "${e}" должно быть undefined или целым числом`}(F,"category_id")]]},description:{validators:[[Q(N(3,1e3)),B(F,"description",3,1e3)]]},due_date_time:{validators:[[Q((function(t){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/.test(t)})),`Свойство сущности ${F} "due_date_time" должно быть датой в формате ISO`]]},deleted:{validators:[[Q(z),X(F,"deleted")]]},completed:{validators:[[Q(z),X(F,"completed")]]}},et=t=>P(t,tt,Y,F);function at(t){const{task_id:e,title:a,priority_id:n,category_id:s,description:r,due_date_time:i,deleted:o,completed:c}=t||{};return{task_id:e,title:a,priority_id:n,category_id:s,description:r,due_date_time:i,deleted:o,completed:c}}const nt={task_id:{validators:[[Z,U(F,"task_id")]],required:!0},...tt},st=t=>P(t,nt,at,F);function rt(t,e,a){return void 0===a&&(a=200),new Response(JSON.stringify({id:t,result:e}),{headers:o,status:a})}class it{constructor(t,e){this.type=t,this.data=e}}async function ot(e,a){t.clients.matchAll().then((t=>{t.forEach((t=>{t.id!==e&&t.postMessage(a)}))}))}async function ct(t){const{request:e}=t,a=k(),{id:n,params:s}=await e.json(),r=await async function(t,e){const a=et(e);if(!a.error){const n=a.result;if(!t.priorities.find((t=>t.priority_id===n.priority_id)))return{error:{message:"Не известный идентификатор приоритета",data:e}};if(!t.categories.find((t=>t.category_id===n.category_id)))return{error:{message:"Не известный идентификатор категории",data:e}};const s=t.tasks.at(-1)?.task_id||0,r={...n,task_id:s+1};return t.tasks.push(r),{result:r}}return a}(a,s);if(r.result){const e=r.result;return await b(a),await ot(t.clientId,new it("create_task",e)),rt(n,e)}return E(n,r.error.message,r.error.data)}async function dt(t){const{request:e}=t,a=k(),{id:n,params:s}=await e.json(),r=await async function(t,e){const a=st(e);if(a.result){const n=a.result,s=t.tasks.findIndex((t=>t.task_id===n.task_id));return-1===s?{error:{message:"Задача не найдена",data:e}}:t.priorities.find((t=>t.priority_id===n.priority_id))?t.categories.find((t=>t.category_id===n.category_id))?(t.tasks[s]=n,{result:n}):{error:{message:"Не известный идентификатор категории",data:e}}:{error:{message:"Не известный идентификатор приоритета",data:e}}}return a}(a,s);if(r.result){const e=r.result;return await b(a),await ot(t.clientId,new it("update_task",e)),rt(n,e)}return E(n,r.error.message,r.error.data)}function ut(t,e){if(t===e)return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;const a=Object.keys(t),n=Object.keys(e);return a.length===n.length&&a.every((a=>n.includes(a)&&ut(t[a],e[a])))}async function lt(t){const{request:e}=t,a=k(),{id:n,params:s}=await e.json(),r=await async function(t,e){const a=st(e);if(a.result){const n=a.result,s=t.tasks.findIndex((t=>ut(at(t),at(n))));return-1===s?{error:{message:"Задача не найдена",data:e}}:(t.tasks.splice(s,1),{result:n})}return a}(a,s);if(r.result){const e=r.result;return await b(a),await ot(t.clientId,new it("delete_task",e)),rt(n,e)}return E(n,r.error.message,r.error.data)}async function ft(t){const{request:e}=t,a=k(),{id:n,params:s}=await e.json(),r=await async function(t,e){const a=M(e);if(a.result){const n=a.result,s=t.categories.find((t=>t.category_name===n.category_name));if(s)return{error:{message:"Категория с таким именем уже существует",data:e}};if(!t.icons.find((t=>t.icon_id===n.icon_id)))return{error:{message:"Не известный идентификатор иконки",data:e}};const r=t.categories.at(-1)?.category_id||0,i={...n,category_id:r+1};return t.categories.push(i),{result:i}}return a}(a,s);if(r.result){const e=r.result;return await b(a),await ot(t.clientId,new it("create_category",e)),rt(n,e)}return E(n,r.error.message,r.error.data)}async function gt(t){const{request:e}=t,a=k(),{id:n,params:s}=await e.json(),r=await async function(t,e){const a=G(e);if(a.result){const n=a.result;let s=t.categories.findIndex((t=>t.category_id===n.category_id));return-1===s?{error:{message:"Категория не найдена",data:e}}:t.categories.find((t=>t.category_name===n.category_name&&t.category_id!==n.category_id))?{error:{message:"Категория с таким именем уже существует",data:e}}:t.icons.find((t=>t.icon_id===n.icon_id))?(s=t.categories.findIndex((t=>t.category_id===n.category_id)),t.categories[s]=n,{result:n}):{error:{message:"Не известный идентификатор иконки",data:e}}}return a}(a,s);if(r.result){const e=r.result;return b(a),await ot(t.clientId,new it("update_category",e)),rt(n,e)}return E(n,r.error.message,r.error.data)}async function yt(t){const{request:e}=t,a=k(),{id:n,params:s}=await e.json(),r=await async function(t,e){const a=G(e);if(a.result){const n=a.result,s=t.categories.findIndex((t=>ut(t,n)));return-1===s?{error:{message:"Категория не найдена",data:e}}:t.tasks.find((t=>t.category_id===n.category_id))?{error:{message:"Категория используется в задачах",data:e}}:(t.categories.splice(s,1),{result:n})}return a}(a,s);if(r.result){const e=r.result;return b(a),await ot(t.clientId,new it("delete_category",e)),rt(n,e)}return E(n,r.error.message,r.error.data)}async function pt(t,e){switch(e){case i:return async function(t){const{request:e}=t,a=await T(),n=e.headers.get("x-request-id");return new Response(JSON.stringify({id:n,result:a}),{headers:o,status:200})}(t);case d:return ft(t);case u:return gt(t);case l:return yt(t);case f:return ct(t);case g:return dt(t);case y:return lt(t);case"/log/info":case"/log/warn":case"/log/error":return async function(t){const{request:e}=t,a=(await e.json()).id||C();return new Response(JSON.stringify({id:a,result:"Ok"}),{headers:o,status:200})}(t);default:return new Response(JSON.stringify({error:{code:404,error:"Not found"}}),{headers:o,status:200})}}t.id=Date.now(),t.VERSION="1.0.0",t.assets=R,t.isRepearing=!1,t.logger=q,t.onerror=O,t.addEventListener("message",(function(e){e.data&&"SKIP_WAITING"===e.data.type&&t.skipWaiting()})),t.addEventListener("fetch",(async function(e){const a=e.request,s=function(t){const{pathname:e}=new URL(t);return e.startsWith(r)?e.slice(r.length):e}(a.url);switch(a.method){case"GET":return async function(){const e=await caches.open(n),a=(await e.keys()).map((t=>new URL(t.url).pathname)),s=t.assets.filter((t=>!a.includes(t)&&!t.startsWith("/offline.")));if(s.length>0&&!t.isRepearing){t.isRepearing=!0;try{await e.addAll(s)}finally{t.isRepearing=!1}}}(),void await async function(e,a){if("document"!==e.request.destination||a!==W)t.assets.includes(a)&&e.respondWith(A(0,e.request.url,a));else{const a=t.assets.find((t=>t.startsWith(`${W}offline.`)&&t.endsWith(".html")))||"";e.respondWith(A(0,a,a))}}(e,s);case"POST":{const t=()=>pt(e,s);return void await async function(t,e,a){if(p.includes(e)){const t=k();t.icons&&0===t.icons.length&&await T()}t.respondWith(a())}(e,s,t)}default:e.respondWith(E(-1,"Не допустимый http метод"))}})),t.addEventListener("install",(async function(e){e.waitUntil(async function(){const e=await caches.open(n),a=(await e.keys()).map((t=>new URL(t.url).pathname)),s=t.assets.filter((t=>!a.includes(t)));t.loadedAssets=s,s.length>0&&await e.addAll(s)}())})),t.addEventListener("activate",(async function(e){e.waitUntil(x()),e.waitUntil(t.clients.claim())}))}();