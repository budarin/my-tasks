!function(){"use strict";const e=self,t=200,r=206,a="assets",i="Content-Security-Policy";const n="/api/",s="get_tasks",o={"Content-Type":"application/json; charset=utf-8"},c="RELOAD_PAGE",d="create_category",u="update_category",l="delete_category",f="create_task",g="update_task",y="delete_task",m=[d,u,l,f,g,y];const p="tasks",_="kv-storage";async function w(e){if(e.icons&&e.icons.length>0){let t;const r=JSON.stringify(e),a=await caches.open(_),i=await a.match(p);void 0!==i&&(t=await i.text()),void 0!==i&&t===r||await a.put(p,new Response(r,{headers:new Headers({...o,"Content-Length":String(r.length)})}))}}let h={tasks:[],categories:[],priorities:[],icons:[]};function k(){return h}async function b(e){h=e,await w(e)}function v(e){const t=new Date;return t.setDate(t.getDate()+e),t.toISOString()}const j={icons:[{icon_id:1,file_name:"page.png"},{icon_id:2,file_name:"home.png"},{icon_id:3,file_name:"other.png"},{icon_id:4,file_name:"warning.png"},{icon_id:5,file_name:"alert.png"},{icon_id:6,file_name:"ball.png"},{icon_id:7,file_name:"bug.png"},{icon_id:8,file_name:"cart.png"},{icon_id:9,file_name:"favorite.png"},{icon_id:10,file_name:"inbox.png"},{icon_id:11,file_name:"life.png"},{icon_id:12,file_name:"mail.png"},{icon_id:13,file_name:"twitter.png"},{icon_id:14,file_name:"note.png"}],priorities:[{priority_id:1,priority_name:"низкий",color:"#808080"},{priority_id:2,priority_name:"нормальный",color:"#000000"},{priority_id:3,priority_name:"повышенный",color:"#008000"},{priority_id:4,priority_name:"высокий",color:"#E56353"}],categories:[{category_id:1,icon_id:3,category_name:"Работа"},{category_id:2,icon_id:2,category_name:"Дом"},{category_id:3,icon_id:6,category_name:"Здоровье"},{category_id:4,icon_id:7,category_name:"Фигня"}],tasks:[{task_id:1,priority_id:1,category_id:1,title:"Todo1",deleted:!1},{task_id:2,priority_id:2,category_id:2,title:"Hover your mouse over a project or item and click the icon on the right side of the item for more",due_date_time:v(-1)},{task_id:3,priority_id:3,category_id:3,title:"Todo3",due_date_time:function(e){const t=new Date;return t.setMinutes(t.getMinutes()+e),t.toISOString()}(1)},{task_id:4,priority_id:4,category_id:1,title:"Todo4",due_date_time:v(1),completed:!0,deleted:!1},{task_id:5,priority_id:4,title:"Todo5"},{task_id:6,category_id:4,priority_id:4,title:"Todo6",completed:!0,deleted:!1},{task_id:7,priority_id:2,title:"Todo7",completed:!0,deleted:!0}]};async function C(){let e=k();const t=await caches.open(_),r=await t.match(p);if(e.icons&&0===e.icons.length){if(void 0!==r){const t=await r.json();if(t)return e=t,await b(e),e}if(e.icons&&0===e.icons.length)return await b(j),j}return r||await w(e),e}async function T(){await async function(){const t=await caches.open(a);let r=(await t.keys()).map((e=>new URL(e.url).pathname));const i=r.filter((t=>!e.assets.includes(t)));i.length>0&&await Promise.all(i.map((async e=>{await t.delete(e),r=r.filter((t=>t!==e))})));const n=e.assets.filter((e=>!r.includes(e)));n.length>0&&await t.addAll(n)}(),await C(),await async function(){e.clients.matchAll().then((e=>{e.forEach((e=>e.postMessage({type:c})))}))}()}const q=()=>{};let O=new Proxy({},{get:()=>q});const P=["C:/Program Files/Git/my-tasks/android-chrome-192x192.1cfc30bbcbf340fc741d.png","C:/Program Files/Git/my-tasks/android-chrome-512x512.558e975c145ffb2a28fd.png","C:/Program Files/Git/my-tasks/android-chrome-maskable-192x192.126708023a549b771f76.png","C:/Program Files/Git/my-tasks/android-chrome-maskable-512x512.d40a692f812ed7f5e7e3.png","C:/Program Files/Git/my-tasks/app.fe287d40ee156b97764f.js","C:/Program Files/Git/my-tasks/apple-touch-icon.7cb6aa9a5fc2e73f0df5.png","C:/Program Files/Git/my-tasks/budarin.4a1954bad283653e8db0.js","C:/Program Files/Git/my-tasks/error.8ad17092b67f41ed6f08.mp3","C:/Program Files/Git/my-tasks/favicon-32x32.88ac8115acd8f90a85e8.png","C:/Program Files/Git/my-tasks/favicon.31159ba4d345a313888e.ico","C:/Program Files/Git/my-tasks/main.057930f238ca33d43ccd.js","C:/Program Files/Git/my-tasks/npms.03b680477565bc10ec71.js","C:/Program Files/Git/my-tasks/react.072e730091aa92f00ee4.js","C:/Program Files/Git/my-tasks/roboto-regular-webfont.7c365dca831ccd4122ac.woff2","C:/Program Files/Git/my-tasks/runtime.252713c7f43a1d4f0aa5.js","C:/Program Files/Git/my-tasks/todo.cd3261e56180c2c0e031.svg","C:/Program Files/Git/my-tasks/manifest.1d15e3825ac4d1bece5322af258b56f1.webmanifest","C:/Program Files/Git/my-tasks/offline.1b396d2f1f15526e1a0747110bd46124.html"];function W(e){}function x(e,t,r){return new Response(JSON.stringify({id:e,error:{code:500,message:t,data:r}}),{headers:o,status:200})}function G(){return navigator.userAgent.toLowerCase().includes("chrome")||navigator.userAgent.toLowerCase().includes("chromium")}const S="C:/Program Files/Git/my-tasks/",R=e=>e.startsWith(`${S}offline.`)&&e.endsWith(".html"),$="default-src 'none'; base-uri 'none'; object-src 'none'; connect-src 'self'; media-src 'self'; manifest-src 'self'; img-src 'self' data: ; worker-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'sha384-awspsacWvBAq6mulvxlzzB61MgSTDeWWJ6et7fHy3afMe0jGHabj3FVrc00CwO0C' 'sha384-Ul13hXxd26CuGKdSBqjdxgWgvOJ0LujQd8PL_Qms8nl8pC94Ey-zBvlEhpvMv9Na' 'sha384-2WZPK9bOk-gNZ-Z8eKZbUPTzTOgw5OrAYWl8epa74e2o9NSBRq32eXWfEnKLR9M9' 'sha384-xnWWkOTSvPAuspyBC92de_b4xZpLVwU4ZWtyeBuEHz3DqExMpCkH-aykTvk1EfrZ' 'sha384-Wb5qOWHhVIBb1eo-smbLMjl-JUGTXxq_-OB7hHHCdXfgAfQWkMbj5bzl5ppR-wRO' 'sha384-mKvTpL5idEXA_pmfTavsSTwY_Uah7A3pfb4TYz__AZS7QGb_hHaECOKTmuiKgwYB' 'sha384-HG4OjTNe41-hNgtwC9RsLWMljrDW3qbEs1NOBy7r5XKRVlj1c0iX2LeTgPkUpo9Y' 'sha384-6npxtMbWaqCITweeOjWU2ldA75-0OiGl4iQmZfa6yw-FZhpT7LiAzkwi1jYngh-V' 'unsafe-inline'; font-src 'self' data:; require-trusted-types-for 'script'; trusted-types webpack-tt default;";async function A(n,s,o){const c=await caches.open(a),d=await c.match(s);if(d){if(R(s)&&!d.headers.get(i)){const e=d.clone(),t=new Headers(d.headers);t.set(i,$);try{let r=await d.text();G()&&(r=r.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""));const a=new Response(r,{status:e.status,statusText:e.statusText,headers:t});return await c.put(s,a.clone()),a}catch(e){return d}}return d}return async function(n,s){let o;const c=await fetch(n);if(null===c.body)return c;const d=new Headers(c.headers);if(c.status===r){const e=await c.blob(),t=await e.arrayBuffer();o=new Response(t,{headers:d})}else{let e;R(n)?(e=await c.text(),d.set(i,$),G()&&(e=e.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""))):e=await c.blob(),o=new Response(e,{headers:d,status:c.status,statusText:c.statusText})}const u=o.status===t;if(!1===u)return c;u&&e.assets.includes(s)&&(await caches.open(a)).put(n,o.clone());return o}(s,o)}function E(e){void 0===e&&(e=Date.now());const t=new Uint8Array(10);!function(e){if(void 0!==globalThis.crypto&&"function"==typeof globalThis.crypto.getRandomValues)return globalThis.crypto.getRandomValues(e);if("function"==typeof require){const t=require("crypto").randomBytes(e.length);return e.set(t),e}throw new Error("Secure random number generation is not supported in this environment.")}(t);const r=e.toString(16).padStart(12,"0"),a=function(e){let t="";for(let r=0;r<e.length;r++){const a=e[r].toString(16);t+=2===a.length?a:"0"+a}return t}(t);return`${r.substring(0,8)}-${r.substring(8)}-${a.substring(0,4)}-${a.substring(4,8)}-${a.substring(8)}`}function F(e){return"number"==typeof e&&Number.isInteger(e)}const I=(e,t)=>`Свойство сущности ${e} "${t}" должно быть целым числом`;function L(e,t){return void 0===t&&(t=65536),r=>"string"==typeof r&&r.length>=e&&r.length<=t}const N=(e,t,r,a)=>`Свойство сущности ${e} "${t}" должно быть строкой длиной от ${r} до ${a} символов`;const U=(e,t,r,a)=>{if(!1===function(e){return"object"==typeof e&&null!==e}(e))return{error:{message:`Сущность "${a}" должна быть объектом`,data:e}};const i=e,n=Object.keys(t);for(let r=0;r<n.length;r++){const s=n[r],o=t[s];if(!0===o.required&&void 0===i[s])return{error:{message:`Свойство "${s}" сущности ${a} отсутствует`,data:e}};for(let t=0;t<o.validators.length;t++){const r=o.validators[t];if(!1===r[0](i[s]))return{error:{message:r[1],data:e}}}}return{result:r(i)}};function B(e){const{icon_id:t,category_name:r}=e||{};return{icon_id:t,category_name:r}}const H="Категория",M={icon_id:{validators:[[F,I(H,"icon_id")]],required:!0},category_name:{validators:[[L(3,20),N(H,"category_name",3,20)]],required:!0}},Z=e=>U(e,M,B,H);function D(e){const{category_id:t,icon_id:r,category_name:a}=e||{};return{category_id:t,icon_id:r,category_name:a}}const J={category_id:{validators:[[F,I(H,"category_id")]],required:!0},...M},K=e=>U(e,J,D,H);function z(e){return t=>void 0===t||e(t)}function V(e){return"boolean"==typeof e}function X(e,t){return`Свойство сущности ${e} "${t}" должно быть undefined или boolean`}function Y(e){const{title:t,priority_id:r,category_id:a,description:i,due_date_time:n,deleted:s,completed:o}=e||{};return{title:t,priority_id:r,category_id:a,description:i,due_date_time:n,deleted:s,completed:o}}const Q="Задача",ee={title:{validators:[[L(3,100),N(Q,"title",3,100)]],required:!0},priority_id:{validators:[[F,I(Q,"priority_id")]],required:!0},category_id:{validators:[[z(F),function(e,t){return`Свойство сущности ${e} "${t}" должно быть undefined или целым числом`}(Q,"category_id")]]},description:{validators:[[z(L(3,1e3)),N(Q,"description",3,1e3)]]},due_date_time:{validators:[[z((function(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/.test(e)})),`Свойство сущности ${Q} "due_date_time" должно быть датой в формате ISO`]]},deleted:{validators:[[z(V),X(Q,"deleted")]]},completed:{validators:[[z(V),X(Q,"completed")]]}},te=e=>U(e,ee,Y,Q);function re(e){const{task_id:t,title:r,priority_id:a,category_id:i,description:n,due_date_time:s,deleted:o,completed:c}=e||{};return{task_id:t,title:r,priority_id:a,category_id:i,description:n,due_date_time:s,deleted:o,completed:c}}const ae={task_id:{validators:[[F,I(Q,"task_id")]],required:!0},...ee},ie=e=>U(e,ae,re,Q);function ne(e,t,r){return void 0===r&&(r=200),new Response(JSON.stringify({id:e,result:t}),{headers:o,status:r})}class se{constructor(e,t){this.type=e,this.data=t}}async function oe(t,r){e.clients.matchAll().then((e=>{e.forEach((e=>{e.id!==t&&e.postMessage(r)}))}))}async function ce(e){const{request:t}=e,r=k(),{id:a,params:i}=await t.json(),n=await async function(e,t){const r=te(t);if(!r.error){const a=r.result;if(!e.priorities.find((e=>e.priority_id===a.priority_id)))return{error:{message:"Не известный идентификатор приоритета",data:t}};if(!e.categories.find((e=>e.category_id===a.category_id)))return{error:{message:"Не известный идентификатор категории",data:t}};const i=e.tasks.at(-1)?.task_id||0,n={...a,task_id:i+1};return e.tasks.push(n),{result:n}}return r}(r,i);if(n.result){const t=n.result;return await b(r),await oe(e.clientId,new se("create_task",t)),ne(a,t)}return x(a,n.error.message,n.error.data)}async function de(e){const{request:t}=e,r=k(),{id:a,params:i}=await t.json(),n=await async function(e,t){const r=ie(t);if(r.result){const a=r.result,i=e.tasks.findIndex((e=>e.task_id===a.task_id));return-1===i?{error:{message:"Задача не найдена",data:t}}:e.priorities.find((e=>e.priority_id===a.priority_id))?e.categories.find((e=>e.category_id===a.category_id))?(e.tasks[i]=a,{result:a}):{error:{message:"Не известный идентификатор категории",data:t}}:{error:{message:"Не известный идентификатор приоритета",data:t}}}return r}(r,i);if(n.result){const t=n.result;return await b(r),await oe(e.clientId,new se("update_task",t)),ne(a,t)}return x(a,n.error.message,n.error.data)}function ue(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const r=Object.keys(e),a=Object.keys(t);return r.length===a.length&&r.every((r=>a.includes(r)&&ue(e[r],t[r])))}async function le(e){const{request:t}=e,r=k(),{id:a,params:i}=await t.json(),n=await async function(e,t){const r=ie(t);if(r.result){const a=r.result,i=e.tasks.findIndex((e=>ue(re(e),re(a))));return-1===i?{error:{message:"Задача не найдена",data:t}}:(e.tasks.splice(i,1),{result:a})}return r}(r,i);if(n.result){const t=n.result;return await b(r),await oe(e.clientId,new se("delete_task",t)),ne(a,t)}return x(a,n.error.message,n.error.data)}async function fe(e){const{request:t}=e,r=k(),{id:a,params:i}=await t.json(),n=await async function(e,t){const r=Z(t);if(r.result){const a=r.result,i=e.categories.find((e=>e.category_name===a.category_name));if(i)return{error:{message:"Категория с таким именем уже существует",data:t}};if(!e.icons.find((e=>e.icon_id===a.icon_id)))return{error:{message:"Не известный идентификатор иконки",data:t}};const n=e.categories.at(-1)?.category_id||0,s={...a,category_id:n+1};return e.categories.push(s),{result:s}}return r}(r,i);if(n.result){const t=n.result;return await b(r),await oe(e.clientId,new se("create_category",t)),ne(a,t)}return x(a,n.error.message,n.error.data)}async function ge(e){const{request:t}=e,r=k(),{id:a,params:i}=await t.json(),n=await async function(e,t){const r=K(t);if(r.result){const a=r.result;let i=e.categories.findIndex((e=>e.category_id===a.category_id));return-1===i?{error:{message:"Категория не найдена",data:t}}:e.categories.find((e=>e.category_name===a.category_name&&e.category_id!==a.category_id))?{error:{message:"Категория с таким именем уже существует",data:t}}:e.icons.find((e=>e.icon_id===a.icon_id))?(i=e.categories.findIndex((e=>e.category_id===a.category_id)),e.categories[i]=a,{result:a}):{error:{message:"Не известный идентификатор иконки",data:t}}}return r}(r,i);if(n.result){const t=n.result;return b(r),await oe(e.clientId,new se("update_category",t)),ne(a,t)}return x(a,n.error.message,n.error.data)}async function ye(e){const{request:t}=e,r=k(),{id:a,params:i}=await t.json(),n=await async function(e,t){const r=K(t);if(r.result){const a=r.result,i=e.categories.findIndex((e=>ue(e,a)));return-1===i?{error:{message:"Категория не найдена",data:t}}:e.tasks.find((e=>e.category_id===a.category_id))?{error:{message:"Категория используется в задачах",data:t}}:(e.categories.splice(i,1),{result:a})}return r}(r,i);if(n.result){const t=n.result;return b(r),await oe(e.clientId,new se("delete_category",t)),ne(a,t)}return x(a,n.error.message,n.error.data)}async function me(e,t){switch(t){case s:return async function(e){const{request:t}=e,r=await C(),a=t.headers.get("x-request-id");return new Response(JSON.stringify({id:a,result:r}),{headers:o,status:200})}(e);case d:return fe(e);case u:return ge(e);case l:return ye(e);case f:return ce(e);case g:return de(e);case y:return le(e);case"/log/info":case"/log/warn":case"/log/error":return async function(e){const{request:t}=e,r=(await t.json()).id||E();return new Response(JSON.stringify({id:r,result:"Ok"}),{headers:o,status:200})}(e);default:return new Response(JSON.stringify({error:{code:404,error:"Not found"}}),{headers:o,status:200})}}e.id=Date.now(),e.VERSION="1.0.0",e.assets=P,e.isRepearing=!1,e.logger=O,e.onerror=W,e.addEventListener("message",(function(t){t.data&&"SKIP_WAITING"===t.data.type&&e.skipWaiting()})),e.addEventListener("fetch",(async function(t){const r=t.request,i=function(e){const{pathname:t}=new URL(e);return t.startsWith(n)?t.slice(n.length):t}(r.url);switch(r.method){case"GET":return async function(){const t=await caches.open(a),r=(await t.keys()).map((e=>new URL(e.url).pathname)),i=e.assets.filter((e=>!r.includes(e)&&!e.startsWith("/offline.")));if(i.length>0&&!e.isRepearing){e.isRepearing=!0;try{await t.addAll(i)}finally{e.isRepearing=!1}}}(),void await async function(t,r){if("document"!==t.request.destination||r!==S)e.assets.includes(r)&&t.respondWith(A(0,t.request.url,r));else{const r=e.assets.find((e=>e.startsWith(`${S}offline.`)&&e.endsWith(".html")))||"";t.respondWith(A(0,r,r))}}(t,i);case"POST":{const e=()=>me(t,i);return void await async function(e,t,r){if(m.includes(t)){const e=k();e.icons&&0===e.icons.length&&await C()}e.respondWith(r())}(t,i,e)}default:t.respondWith(x(-1,"Не допустимый http метод"))}})),e.addEventListener("install",(async function(t){t.waitUntil(async function(){const t=await caches.open(a),r=(await t.keys()).map((e=>new URL(e.url).pathname)),i=e.assets.filter((e=>!r.includes(e)));e.loadedAssets=i,i.length>0&&await t.addAll(i)}())})),e.addEventListener("activate",(async function(t){t.waitUntil(T()),t.waitUntil(e.clients.claim())}))}();