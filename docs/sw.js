<<<<<<< HEAD
!function(){"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),function(){var e;t.g.importScripts&&(e=t.g.location+"");var a=t.g.document;if(!e&&a&&(a.currentScript&&(e=a.currentScript.src),!e)){var n=a.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&!e;)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e}();const e=self,a=200,n=206,r="assets",s="Content-Security-Policy";const i="/api/",o="get_tasks",c={"Content-Type":"application/json; charset=utf-8"},d="RELOAD_PAGE",u="create_category",l="update_category",f="delete_category",p="create_task",g="update_task",y="delete_task",m=[u,l,f,p,g,y];const _="tasks",h="kv-storage";async function w(t){if(t.icons&&t.icons.length>0){let e;const a=JSON.stringify(t),n=await caches.open(h),r=await n.match(_);void 0!==r&&(e=await r.text()),void 0!==r&&e===a||await n.put(_,new Response(a,{headers:new Headers({...c,"Content-Length":String(a.length)})}))}}let b={tasks:[],categories:[],priorities:[],icons:[]};function k(){return b}async function v(t){b=t,await w(t)}function x(t){const e=new Date;return e.setDate(e.getDate()+t),e.toISOString()}const S={icons:[{icon_id:1,file_name:"page.png"},{icon_id:2,file_name:"home.png"},{icon_id:3,file_name:"other.png"},{icon_id:4,file_name:"warning.png"},{icon_id:5,file_name:"alert.png"},{icon_id:6,file_name:"ball.png"},{icon_id:7,file_name:"bug.png"},{icon_id:8,file_name:"cart.png"},{icon_id:9,file_name:"favorite.png"},{icon_id:10,file_name:"inbox.png"},{icon_id:11,file_name:"life.png"},{icon_id:12,file_name:"mail.png"},{icon_id:13,file_name:"twitter.png"},{icon_id:14,file_name:"note.png"}],priorities:[{priority_id:1,priority_name:"низкий",color:"#808080"},{priority_id:2,priority_name:"нормальный",color:"#000000"},{priority_id:3,priority_name:"повышенный",color:"#008000"},{priority_id:4,priority_name:"высокий",color:"#E56353"}],categories:[{category_id:1,icon_id:3,category_name:"Работа"},{category_id:2,icon_id:2,category_name:"Дом"},{category_id:3,icon_id:6,category_name:"Здоровье"},{category_id:4,icon_id:7,category_name:"Фигня"}],tasks:[{task_id:1,priority_id:1,category_id:1,title:"Todo1",deleted:!1},{task_id:2,priority_id:2,category_id:2,title:"Hover your mouse over a project or item and click the icon on the right side of the item for more",expire_date_time:x(-1)},{task_id:3,priority_id:3,category_id:3,title:"Todo3",expire_date_time:function(t){const e=new Date;return e.setMinutes(e.getMinutes()+t),e.toISOString()}(1)},{task_id:4,priority_id:4,category_id:1,title:"Todo4",expire_date_time:x(1),completed:!0,deleted:!1},{task_id:5,priority_id:4,title:"Todo5"},{task_id:6,category_id:4,priority_id:4,title:"Todo6",completed:!0,deleted:!1},{task_id:7,priority_id:2,title:"Todo7",completed:!0,deleted:!0}]};async function q(){let t=k();const e=await caches.open(h),a=await e.match(_);if(t.icons&&0===t.icons.length){if(void 0!==a){const e=await a.json();if(e)return t=e,await v(t),t}if(t.icons&&0===t.icons.length)return await v(S),S}return a||await w(t),t}async function $(){await async function(){const t=await caches.open(r);let a=(await t.keys()).map((t=>new URL(t.url).pathname));const n=a.filter((t=>!e.assets.includes(t)));n.length>0&&await Promise.all(n.map((async e=>{await t.delete(e),a=a.filter((t=>t!==e))})));const s=e.assets.filter((t=>!a.includes(t)));s.length>0&&await t.addAll(s)}(),await q(),await async function(){e.clients.matchAll().then((t=>{t.forEach((t=>t.postMessage({type:d})))}))}()}const j=()=>{};let O=new Proxy({},{get:()=>j});const T=["/my-tasks/alert.476b00abda902b398be7.png","/my-tasks/android-chrome-192x192.1cfc30bbcbf340fc741d.png","/my-tasks/android-chrome-512x512.558e975c145ffb2a28fd.png","/my-tasks/android-chrome-maskable-192x192.126708023a549b771f76.png","/my-tasks/android-chrome-maskable-512x512.d40a692f812ed7f5e7e3.png","/my-tasks/app.3abe29f34f38a30df63c.js","/my-tasks/apple-touch-icon.7cb6aa9a5fc2e73f0df5.png","/my-tasks/ball.3d996bafa729a1d3f580.png","/my-tasks/budarin.975624607a4350da8bf0.js","/my-tasks/bug.83b52ad3ded9ef1fbd18.png","/my-tasks/cart.2d640112b4b86b627ff7.png","/my-tasks/error.8ad17092b67f41ed6f08.mp3","/my-tasks/expired.45d759abb485d88b78aa.svg","/my-tasks/favicon-32x32.88ac8115acd8f90a85e8.png","/my-tasks/favicon.31159ba4d345a313888e.ico","/my-tasks/favorite.7f0174c25660ef72df60.png","/my-tasks/folder_red.66f2d7c840bd3b9aed95.png","/my-tasks/help.83136d93df7a9872ae11.svg","/my-tasks/home.3e40fe2b97b19c75dfaf.png","/my-tasks/icon.cd3261e56180c2c0e031.svg","/my-tasks/inbox.58a834f614e341f9c578.png","/my-tasks/life.5896aaa56394aa0273b3.png","/my-tasks/mail.4a4239588f1b0d37bcfc.png","/my-tasks/main.8467580207222e5e10fc.js","/my-tasks/next.4b695e6dc3fabdcc84b4.png","/my-tasks/note.8e112a51a84fa9c09b11.png","/my-tasks/npms.476e0a8c20f655a96b48.js","/my-tasks/other.66c872e04e2846cafa68.png","/my-tasks/page.9d1fc4484b1e5929b7ee.png","/my-tasks/react.072e730091aa92f00ee4.js","/my-tasks/refresh.7c9f0768269a6bbec081.png","/my-tasks/roboto-regular-webfont.7c365dca831ccd4122ac.woff2","/my-tasks/runtime.ff20424b702a3b86ea7c.js","/my-tasks/settings.231ef2d68a51da6cad41.svg","/my-tasks/state.c56984d48249544ade49.svg","/my-tasks/today.141e3d87afbd71da541c.png","/my-tasks/trash.3e03c195726c2cccdc94.gif","/my-tasks/twitter.5556cda0273e796d6a65.png","/my-tasks/warning.4f48c087dcbbdb3bd268.png","/my-tasks/manifest.75b827fa15f3cd092c527e3849a6ec9a.webmanifest","/my-tasks/offline.cb688e9c05ccf07560a1186c7df0a7bc.html"];function E(t){}function A(t,e,a){return new Response(JSON.stringify({id:t,error:{code:500,message:e,data:a}}),{headers:c,status:200})}function I(){return navigator.userAgent.toLowerCase().includes("chrome")||navigator.userAgent.toLowerCase().includes("chromium")}const R="/my-tasks/",W=t=>t.startsWith(`${R}offline.`)&&t.endsWith(".html"),L="default-src 'none'; base-uri 'none'; object-src 'none'; connect-src 'self'; media-src 'self'; manifest-src 'self'; img-src 'self' data: ; worker-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'sha384-ZbiWq4wJZC6uxAz4kIquAHNBsivHh6aZBePQBKuX1KvsWe0PH9Q37UVZP1-iv60W' 'sha384-Ul13hXxd26CuGKdSBqjdxgWgvOJ0LujQd8PL_Qms8nl8pC94Ey-zBvlEhpvMv9Na' 'sha384-2WZPK9bOk-gNZ-Z8eKZbUPTzTOgw5OrAYWl8epa74e2o9NSBRq32eXWfEnKLR9M9' 'sha384-YtACBJfofwdAvnlnuOZcbPNXXpPffsw8lLO087EqU1vw0-HkhG2c4myEVyUigP0S' 'sha384-LZahJDUSnVoDzOfDuBdSo5g2toLfcsBvmX2b0gswnxhygIpWOw-H8CgX2nZMkOW6' 'sha384-ZxdIH9rOmzI9mKiY3IK3t9yowhdp3UOXhrAl5nCJMpWKAC3ey3xvLkWH8ThnPHJT' 'sha384-NEEaHkxuTws8edJEV6R-hmABpUfYB9SZoB6zrn9q4XT15-QAGfGrSGVhdA1vdQzK' 'sha384-DlvY06P7yatmCHZmE3Bq_3E66rLZ9QY0xNo4hzE6FoHMQfrvAkFmpvt24YH8z9Qt'; font-src 'self' data:; require-trusted-types-for 'script'; trusted-types webpack-tt default;";async function N(t,i,o){const c=await caches.open(r),d=await c.match(i);if(d){if(W(i)&&!d.headers.get(s)){const t=d.clone(),e=new Headers(d.headers);e.set(s,L);try{let a=await d.text();I()&&(a=a.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""));const n=new Response(a,{status:t.status,statusText:t.statusText,headers:e});return await c.put(i,n.clone()),n}catch(t){return d}}return d}return async function(t,i){let o;const c=await fetch(t);if(null===c.body)return c;const d=new Headers(c.headers);if(c.status===n){const t=await c.blob(),e=await t.arrayBuffer();o=new Response(e,{headers:d})}else{let e;W(t)?(e=await c.text(),d.set(s,L),I()&&(e=e.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""))):e=await c.blob(),o=new Response(e,{headers:d,status:c.status,statusText:c.statusText})}const u=o.status===a;if(!1===u)return c;u&&e.assets.includes(i)&&(await caches.open(r)).put(t,o.clone());return o}(i,o)}function P(t){void 0===t&&(t=Date.now());const e=new Uint8Array(10);!function(t){if(void 0!==globalThis.crypto&&"function"==typeof globalThis.crypto.getRandomValues)return globalThis.crypto.getRandomValues(t);if("function"==typeof require){const e=require("crypto").randomBytes(t.length);return t.set(e),t}throw new Error("Secure random number generation is not supported in this environment.")}(e);const a=t.toString(16).padStart(12,"0"),n=function(t){let e="";for(let a=0;a<t.length;a++){const n=t[a].toString(16);e+=2===n.length?n:"0"+n}return e}(e);return`${a.substring(0,8)}-${a.substring(8)}-${n.substring(0,4)}-${n.substring(4,8)}-${n.substring(8)}`}function B(t){return"number"==typeof t&&Number.isInteger(t)}const H=(t,e)=>`Свойство сущности ${t} "${e}" должно быть целым числом`;function U(t,e){return void 0===e&&(e=65536),a=>"string"==typeof a&&a.length>=t&&a.length<=e}const Z=(t,e,a,n)=>`Свойство сущности ${t} "${e}" должно быть строкой длиной от ${a} до ${n} символов`;const C=(t,e,a,n)=>{if(!1===function(t){return"object"==typeof t&&null!==t}(t))return{error:{message:`Сущность "${n}" должна быть объектом`,data:t}};const r=t,s=Object.keys(e);for(let a=0;a<s.length;a++){const i=s[a],o=e[i];if(!0===o.required&&void 0===r[i])return{error:{message:`Свойство "${i}" сущности ${n} отсутствует`,data:t}};for(let e=0;e<o.validators.length;e++){const a=o.validators[e];if(!1===a[0](r[i]))return{error:{message:a[1],data:t}}}}return{result:a(r)}};function J(t){const{icon_id:e,category_name:a}=t||{};return{icon_id:e,category_name:a}}const D="Категория",K={icon_id:{validators:[[B,H(D,"icon_id")]],required:!0},category_name:{validators:[[U(3,20),Z(D,"category_name",3,20)]],required:!0}},z=t=>C(t,K,J,D);function M(t){const{category_id:e,icon_id:a,category_name:n}=t||{};return{category_id:e,icon_id:a,category_name:n}}const Q={category_id:{validators:[[B,H(D,"category_id")]],required:!0},...K},X=t=>C(t,Q,M,D);function G(t){return e=>void 0===e||t(e)}function V(t){return"boolean"==typeof t}function Y(t,e){return`Свойство сущности ${t} "${e}" должно быть undefined или boolean`}function F(t){const{title:e,priority_id:a,category_id:n,description:r,expire_date_time:s,deleted:i,completed:o}=t||{};return{title:e,priority_id:a,category_id:n,description:r,expire_date_time:s,deleted:i,completed:o}}const tt="Задача",et={title:{validators:[[U(3,100),Z(tt,"title",3,100)]],required:!0},priority_id:{validators:[[B,H(tt,"priority_id")]],required:!0},category_id:{validators:[[G(B),function(t,e){return`Свойство сущности ${t} "${e}" должно быть undefined или целым числом`}(tt,"category_id")]]},description:{validators:[[G(U(3,1e3)),Z(tt,"description",3,1e3)]]},expire_date_time:{validators:[[G((function(t){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/.test(t)})),`Свойство сущности ${tt} "expire_date_time" должно быть датой в формате ISO`]]},deleted:{validators:[[G(V),Y(tt,"deleted")]]},completed:{validators:[[G(V),Y(tt,"completed")]]}},at=t=>C(t,et,F,tt);function nt(t){const{task_id:e,title:a,priority_id:n,category_id:r,description:s,expire_date_time:i,deleted:o,completed:c}=t||{};return{task_id:e,title:a,priority_id:n,category_id:r,description:s,expire_date_time:i,deleted:o,completed:c}}const rt={task_id:{validators:[[B,H(tt,"task_id")]],required:!0},...et},st=t=>C(t,rt,nt,tt);t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p,t.p;function it(t){return"string"==typeof t}function ot(t,e){return`Свойство сущности ${t} "${e}" должно быть строкой`}function ct(t){return e=>t.includes(e)}function dt(t,e){return`Свойство сущности ${t} "${e}" должно быть значением из списка`}const ut="others",lt="settings",ft="about",pt="store_state",gt=[lt,pt,ft];const yt="Навигационный фильтр",mt=(ot(yt,"title"),ct(gt),dt(yt,"title"),ot(yt,"type"),"filter"),_t="inbox",ht="trash",wt="expired",bt="completed",kt=[_t,wt,bt,ht];const vt="Навигационный фильтр",xt=(ot(vt,"title"),ct(kt),dt(vt,"title"),ot(vt,"type"),"calendar");const St="Навигационный фильтр",qt=(H(St,"key"),ot(St,"type"),"category");const $t="Навигационный фильтр";H($t,"key"),ot($t,"type");function jt(t,e,a){return void 0===a&&(a=200),new Response(JSON.stringify({id:t,result:e}),{headers:c,status:a})}class Ot{constructor(t,e){this.type=t,this.data=e}}async function Tt(t,a){e.clients.matchAll().then((e=>{e.forEach((e=>{e.id!==t&&e.postMessage(a)}))}))}async function Et(t){const{request:e}=t,a=k(),{id:n,params:r}=await e.json(),s=await async function(t,e){const a=at(e);if(!a.error){const n=a.result;if(!t.priorities.find((t=>t.priority_id===n.priority_id)))return{error:{message:"Не известный идентификатор приоритета",data:e}};if(!t.categories.find((t=>t.category_id===n.category_id)))return{error:{message:"Не известный идентификатор категории",data:e}};const r=t.tasks.at(-1)?.task_id||0,s={...n,task_id:r+1};return t.tasks.push(s),{result:s}}return a}(a,r);if(s.result){const e=s.result;return await v(a),await Tt(t.clientId,new Ot("create_task",e)),jt(n,e)}return A(n,s.error.message,s.error.data)}async function At(t){const{request:e}=t,a=k(),{id:n,params:r}=await e.json(),s=await async function(t,e){const a=st(e);if(a.result){const n=a.result,r=t.tasks.findIndex((t=>t.task_id===n.task_id));return-1===r?{error:{message:"Задача не найдена",data:e}}:t.priorities.find((t=>t.priority_id===n.priority_id))?t.categories.find((t=>t.category_id===n.category_id))?(t.tasks[r]=n,{result:n}):{error:{message:"Не известный идентификатор категории",data:e}}:{error:{message:"Не известный идентификатор приоритета",data:e}}}return a}(a,r);if(s.result){const e=s.result;return await v(a),await Tt(t.clientId,new Ot("update_task",e)),jt(n,e)}return A(n,s.error.message,s.error.data)}function It(t,e){if(t===e)return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;const a=Object.keys(t),n=Object.keys(e);return a.length===n.length&&a.every((a=>n.includes(a)&&It(t[a],e[a])))}async function Rt(t){const{request:e}=t,a=k(),{id:n,params:r}=await e.json(),s=await async function(t,e){const a=st(e);if(a.result){const n=a.result,r=t.tasks.findIndex((t=>It(nt(t),nt(n))));return-1===r?{error:{message:"Задача не найдена",data:e}}:(t.tasks.splice(r,1),{result:n})}return a}(a,r);if(s.result){const e=s.result;return await v(a),await Tt(t.clientId,new Ot("delete_task",e)),jt(n,e)}return A(n,s.error.message,s.error.data)}async function Wt(t){const{request:e}=t,a=k(),{id:n,params:r}=await e.json(),s=await async function(t,e){const a=z(e);if(a.result){const n=a.result,r=t.categories.find((t=>t.category_name===n.category_name));if(r)return{error:{message:"Категория с таким именем уже существует",data:e}};if(!t.icons.find((t=>t.icon_id===n.icon_id)))return{error:{message:"Не известный идентификатор иконки",data:e}};const s=t.categories.at(-1)?.category_id||0,i={...n,category_id:s+1};return t.categories.push(i),{result:i}}return a}(a,r);if(s.result){const e=s.result;return await v(a),await Tt(t.clientId,new Ot("create_category",e)),jt(n,e)}return A(n,s.error.message,s.error.data)}async function Lt(t){const{request:e}=t,a=k(),{id:n,params:r}=await e.json(),s=await async function(t,e){const a=X(e);if(a.result){const n=a.result;let r=t.categories.findIndex((t=>t.category_id===n.category_id));return-1===r?{error:{message:"Категория не найдена",data:e}}:t.categories.find((t=>t.category_name===n.category_name&&t.category_id!==n.category_id))?{error:{message:"Категория с таким именем уже существует",data:e}}:t.icons.find((t=>t.icon_id===n.icon_id))?(r=t.categories.findIndex((t=>t.category_id===n.category_id)),t.categories[r]=n,{result:n}):{error:{message:"Не известный идентификатор иконки",data:e}}}return a}(a,r);if(s.result){const e=s.result;return v(a),await Tt(t.clientId,new Ot("update_category",e)),jt(n,e)}return A(n,s.error.message,s.error.data)}async function Nt(t){const{request:e}=t,a=k(),{id:n,params:r}=await e.json(),s=await async function(t,e){const a=X(e);if(a.result){const n=a.result,r=t.categories.findIndex((t=>It(t,n)));return-1===r?{error:{message:"Категория не найдена",data:e}}:t.tasks.find((t=>t.category_id===n.category_id))?{error:{message:"Категория используется в задачах",data:e}}:(t.categories.splice(r,1),{result:n})}return a}(a,r);if(s.result){const e=s.result;return v(a),await Tt(t.clientId,new Ot("delete_category",e)),jt(n,e)}return A(n,s.error.message,s.error.data)}async function Pt(t,e){switch(e){case o:return async function(t){const{request:e}=t,a=await q(),n=e.headers.get("x-request-id");return new Response(JSON.stringify({id:n,result:a}),{headers:c,status:200})}(t);case u:return Wt(t);case l:return Lt(t);case f:return Nt(t);case p:return Et(t);case g:return At(t);case y:return Rt(t);case"/log/info":case"/log/warn":case"/log/error":return async function(t){const{request:e}=t,a=(await e.json()).id||P();return new Response(JSON.stringify({id:a,result:"Ok"}),{headers:c,status:200})}(t);default:return new Response(JSON.stringify({error:{code:404,error:"Not found"}}),{headers:c,status:200})}}e.id=Date.now(),e.VERSION="1.0.11",e.assets=T,e.isRepearing=!1,e.logger=O,e.onerror=E,e.addEventListener("message",(function(t){t.data&&"SKIP_WAITING"===t.data.type&&e.skipWaiting()})),e.addEventListener("fetch",(async function(t){const a=t.request,n=function(t){const{pathname:e}=new URL(t);return e.startsWith(i)?e.slice(i.length):e}(a.url);switch(a.method){case"GET":return async function(){const t=await caches.open(r),a=(await t.keys()).map((t=>new URL(t.url).pathname)),n=e.assets.filter((t=>!a.includes(t)&&!t.startsWith("/offline.")));if(n.length>0&&!e.isRepearing){e.isRepearing=!0;try{await t.addAll(n)}finally{e.isRepearing=!1}}}(),void await async function(t,a){if("document"!==t.request.destination||a!==R)e.assets.includes(a)&&t.respondWith(N(0,t.request.url,a));else{const a=e.assets.find((t=>t.startsWith(`${R}offline.`)&&t.endsWith(".html")))||"";t.respondWith(N(0,a,a))}}(t,n);case"POST":{const e=()=>Pt(t,n);return void await async function(t,e,a){if(m.includes(e)){const t=k();t.icons&&0===t.icons.length&&await q()}t.respondWith(a())}(t,n,e)}default:t.respondWith(A(-1,"Не допустимый http метод"))}})),e.addEventListener("install",(async function(t){t.waitUntil(async function(){const t=await caches.open(r),a=(await t.keys()).map((t=>new URL(t.url).pathname)),n=e.assets.filter((t=>!a.includes(t)));e.loadedAssets=n,n.length>0&&await t.addAll(n)}())})),e.addEventListener("activate",(async function(t){t.waitUntil($()),t.waitUntil(e.clients.claim())}))}();
=======
!function(){"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var t;e.g.importScripts&&(t=e.g.location+"");var a=e.g.document;if(!t&&a&&(a.currentScript&&(t=a.currentScript.src),!t)){var n=a.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&!t;)t=n[r--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t}();const t=self,a=200,n=206,r="assets",i="Content-Security-Policy";const s="/api/",o="get_tasks",c={"Content-Type":"application/json; charset=utf-8"},d="RELOAD_PAGE",u="create_category",l="update_category",f="delete_category",p="create_task",g="update_task",y="delete_task",m=[u,l,f,p,g,y];const _="tasks",h="kv-storage";async function w(e){if(e.icons&&e.icons.length>0){let t;const a=JSON.stringify(e),n=await caches.open(h),r=await n.match(_);void 0!==r&&(t=await r.text()),void 0!==r&&t===a||await n.put(_,new Response(a,{headers:new Headers({...c,"Content-Length":String(a.length)})}))}}let b={tasks:[],categories:[],priorities:[],icons:[]};function k(){return b}async function v(e){b=e,await w(e)}function x(e){const t=new Date;return t.setDate(t.getDate()+e),t.toISOString()}const S={icons:[{icon_id:1,file_name:"page.png"},{icon_id:2,file_name:"home.png"},{icon_id:3,file_name:"other.png"},{icon_id:4,file_name:"warning.png"},{icon_id:5,file_name:"alert.png"},{icon_id:6,file_name:"ball.png"},{icon_id:7,file_name:"bug.png"},{icon_id:8,file_name:"cart.png"},{icon_id:9,file_name:"favorite.png"},{icon_id:10,file_name:"inbox.png"},{icon_id:11,file_name:"life.png"},{icon_id:12,file_name:"mail.png"},{icon_id:13,file_name:"twitter.png"},{icon_id:14,file_name:"note.png"}],priorities:[{priority_id:1,priority_name:"низкий",color:"#808080"},{priority_id:2,priority_name:"нормальный",color:"#000000"},{priority_id:3,priority_name:"повышенный",color:"#008000"},{priority_id:4,priority_name:"высокий",color:"#E56353"}],categories:[{category_id:1,icon_id:3,category_name:"Работа"},{category_id:2,icon_id:2,category_name:"Дом"},{category_id:3,icon_id:6,category_name:"Здоровье"},{category_id:4,icon_id:7,category_name:"Фигня"}],tasks:[{task_id:1,priority_id:1,category_id:1,title:"Todo1",deleted:!1},{task_id:2,priority_id:2,category_id:2,title:"Hover your mouse over a project or item and click the icon on the right side of the item for more",expire_date_time:x(-1)},{task_id:3,priority_id:3,category_id:3,title:"Todo3",expire_date_time:function(e){const t=new Date;return t.setMinutes(t.getMinutes()+e),t.toISOString()}(1)},{task_id:4,priority_id:4,category_id:1,title:"Todo4",expire_date_time:x(1),completed:!0,deleted:!1},{task_id:5,priority_id:4,title:"Todo5"},{task_id:6,category_id:4,priority_id:4,title:"Todo6",completed:!0,deleted:!1},{task_id:7,priority_id:2,title:"Todo7",completed:!0,deleted:!0}]};async function O(){let e=k();const t=await caches.open(h),a=await t.match(_);if(e.icons&&0===e.icons.length){if(void 0!==a){const t=await a.json();if(t)return e=t,await v(e),e}if(e.icons&&0===e.icons.length)return await v(S),S}return a||await w(e),e}async function j(){await async function(){const e=await caches.open(r);let a=(await e.keys()).map((e=>new URL(e.url).pathname));const n=a.filter((e=>!t.assets.includes(e)));n.length>0&&await Promise.all(n.map((async t=>{await e.delete(t),a=a.filter((e=>e!==t))})));const i=t.assets.filter((e=>!a.includes(e)));i.length>0&&await e.addAll(i)}(),await O(),await async function(){t.clients.matchAll().then((e=>{e.forEach((e=>e.postMessage({type:d})))}))}()}const R=()=>{};let $=new Proxy({},{get:()=>R});const q=["/my-tasks/alert.476b00abda902b398be7.png","/my-tasks/android-chrome-192x192.1cfc30bbcbf340fc741d.png","/my-tasks/android-chrome-512x512.558e975c145ffb2a28fd.png","/my-tasks/android-chrome-maskable-192x192.126708023a549b771f76.png","/my-tasks/android-chrome-maskable-512x512.d40a692f812ed7f5e7e3.png","/my-tasks/app.3cd5fa630eed26e258f5.js","/my-tasks/apple-touch-icon.7cb6aa9a5fc2e73f0df5.png","/my-tasks/ball.3d996bafa729a1d3f580.png","/my-tasks/budarin.975624607a4350da8bf0.js","/my-tasks/bug.83b52ad3ded9ef1fbd18.png","/my-tasks/cart.2d640112b4b86b627ff7.png","/my-tasks/error.8ad17092b67f41ed6f08.mp3","/my-tasks/expired.45d759abb485d88b78aa.svg","/my-tasks/favicon-32x32.88ac8115acd8f90a85e8.png","/my-tasks/favicon.31159ba4d345a313888e.ico","/my-tasks/favorite.7f0174c25660ef72df60.png","/my-tasks/folder_red.66f2d7c840bd3b9aed95.png","/my-tasks/help.83136d93df7a9872ae11.svg","/my-tasks/home.3e40fe2b97b19c75dfaf.png","/my-tasks/icon.cd3261e56180c2c0e031.svg","/my-tasks/inbox.58a834f614e341f9c578.png","/my-tasks/life.5896aaa56394aa0273b3.png","/my-tasks/mail.4a4239588f1b0d37bcfc.png","/my-tasks/main.25bb289f7114e2781c1c.js","/my-tasks/next.4b695e6dc3fabdcc84b4.png","/my-tasks/note.8e112a51a84fa9c09b11.png","/my-tasks/npms.476e0a8c20f655a96b48.js","/my-tasks/other.66c872e04e2846cafa68.png","/my-tasks/page.9d1fc4484b1e5929b7ee.png","/my-tasks/react.072e730091aa92f00ee4.js","/my-tasks/refresh.7c9f0768269a6bbec081.png","/my-tasks/roboto-regular-webfont.7c365dca831ccd4122ac.woff2","/my-tasks/runtime.9c2eccedc840528d2f6a.js","/my-tasks/settings.231ef2d68a51da6cad41.svg","/my-tasks/state.c56984d48249544ade49.svg","/my-tasks/today.141e3d87afbd71da541c.png","/my-tasks/trash.3e03c195726c2cccdc94.gif","/my-tasks/twitter.5556cda0273e796d6a65.png","/my-tasks/warning.4f48c087dcbbdb3bd268.png","/my-tasks/manifest.75b827fa15f3cd092c527e3849a6ec9a.webmanifest","/my-tasks/offline.b3aa06a0e3776be487ba853091dafea6.html"];function T(e){}function W(e,t,a){return new Response(JSON.stringify({id:e,error:{code:500,message:t,data:a}}),{headers:c,status:200})}function I(){return navigator.userAgent.toLowerCase().includes("chrome")||navigator.userAgent.toLowerCase().includes("chromium")}const E="/my-tasks/",A=e=>e.startsWith(`${E}offline.`)&&e.endsWith(".html"),L="default-src 'none'; base-uri 'none'; object-src 'none'; connect-src 'self'; media-src 'self'; manifest-src 'self'; img-src 'self' data: ; worker-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'sha384-ZbiWq4wJZC6uxAz4kIquAHNBsivHh6aZBePQBKuX1KvsWe0PH9Q37UVZP1-iv60W' 'sha384-Ul13hXxd26CuGKdSBqjdxgWgvOJ0LujQd8PL_Qms8nl8pC94Ey-zBvlEhpvMv9Na' 'sha384-2WZPK9bOk-gNZ-Z8eKZbUPTzTOgw5OrAYWl8epa74e2o9NSBRq32eXWfEnKLR9M9' 'sha384-YB6nHD0z6ZSTEi7hy0BwufffqTbFa6SJSmCrfDs-pHRse4Vog-u-S-pbauO4emKt' 'sha384-LZahJDUSnVoDzOfDuBdSo5g2toLfcsBvmX2b0gswnxhygIpWOw-H8CgX2nZMkOW6' 'sha384-ZxdIH9rOmzI9mKiY3IK3t9yowhdp3UOXhrAl5nCJMpWKAC3ey3xvLkWH8ThnPHJT' 'sha384-6u9U9hE2XXifSiMmcROKZzJNQeNn2PnLrzcJDNSXOz0ncED0XUjmoaqf-twRh8A5' 'sha384-6oU8VhRgS5DOjiKW8HHpm_KzuQ_MExfOJP1MaRn5NVtponxe-TdbWGXQQRpoBCvo'; font-src 'self' data:; require-trusted-types-for 'script'; trusted-types webpack-tt default;";async function N(e,s,o){const c=await caches.open(r),d=await c.match(s);if(d){if(A(s)&&!d.headers.get(i)){const e=d.clone(),t=new Headers(d.headers);t.set(i,L);try{let a=await d.text();I()&&(a=a.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""));const n=new Response(a,{status:e.status,statusText:e.statusText,headers:t});return await c.put(s,n.clone()),n}catch(e){return d}}return d}return async function(e,s){let o;const c=await fetch(e);if(null===c.body)return c;const d=new Headers(c.headers);if(c.status===n){const e=await c.blob(),t=await e.arrayBuffer();o=new Response(t,{headers:d})}else{let t;A(e)?(t=await c.text(),d.set(i,L),I()&&(t=t.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""))):t=await c.blob(),o=new Response(t,{headers:d,status:c.status,statusText:c.statusText})}const u=o.status===a;if(!1===u)return c;u&&t.assets.includes(s)&&(await caches.open(r)).put(e,o.clone());return o}(s,o)}function P(e){void 0===e&&(e=Date.now());const t=new Uint8Array(10);!function(e){if(void 0!==globalThis.crypto&&"function"==typeof globalThis.crypto.getRandomValues)return globalThis.crypto.getRandomValues(e);if("function"==typeof require){const t=require("crypto").randomBytes(e.length);return e.set(t),e}throw new Error("Secure random number generation is not supported in this environment.")}(t);const a=e.toString(16).padStart(12,"0"),n=function(e){let t="";for(let a=0;a<e.length;a++){const n=e[a].toString(16);t+=2===n.length?n:"0"+n}return t}(t);return`${a.substring(0,8)}-${a.substring(8)}-${n.substring(0,4)}-${n.substring(4,8)}-${n.substring(8)}`}function U(e){return"number"==typeof e&&Number.isInteger(e)}const D=(e,t)=>`Свойство сущности ${e} "${t}" должно быть целым числом`;function H(e,t){return void 0===t&&(t=65536),a=>"string"==typeof a&&a.length>=e&&a.length<=t}const J=(e,t,a,n)=>`Свойство сущности ${e} "${t}" должно быть строкой длиной от ${a} до ${n} символов`;const B=(e,t,a,n)=>{if(!1===function(e){return"object"==typeof e&&null!==e}(e))return{error:{message:`Сущность "${n}" должна быть объектом`,data:e}};const r=e,i=Object.keys(t);for(let a=0;a<i.length;a++){const s=i[a],o=t[s];if(!0===o.required&&void 0===r[s])return{error:{message:`Свойство "${s}" сущности ${n} отсутствует`,data:e}};for(let t=0;t<o.validators.length;t++){const a=o.validators[t];if(!1===a[0](r[s]))return{error:{message:a[1],data:e}}}}return{result:a(r)}};function K(e){const{icon_id:t,category_name:a}=e||{};return{icon_id:t,category_name:a}}const Z="Категория",C={icon_id:{validators:[[U,D(Z,"icon_id")]],required:!0},category_name:{validators:[[H(3,20),J(Z,"category_name",3,20)]],required:!0}},M=e=>B(e,C,K,Z);function X(e){const{category_id:t,icon_id:a,category_name:n}=e||{};return{category_id:t,icon_id:a,category_name:n}}const z={category_id:{validators:[[U,D(Z,"category_id")]],required:!0},...C},Q=e=>B(e,z,X,Z);function V(e){return t=>void 0===t||e(t)}function G(e){return"boolean"==typeof e}function Y(e,t){return`Свойство сущности ${e} "${t}" должно быть undefined или boolean`}function F(e){const{title:t,priority_id:a,category_id:n,description:r,expire_date_time:i,deleted:s,completed:o}=e||{};return{title:t,priority_id:a,category_id:n,description:r,expire_date_time:i,deleted:s,completed:o}}const ee="Задача",te={title:{validators:[[H(3,100),J(ee,"title",3,100)]],required:!0},priority_id:{validators:[[U,D(ee,"priority_id")]],required:!0},category_id:{validators:[[V(U),function(e,t){return`Свойство сущности ${e} "${t}" должно быть undefined или целым числом`}(ee,"category_id")]]},description:{validators:[[V(H(3,1e3)),J(ee,"description",3,1e3)]]},expire_date_time:{validators:[[V((function(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/.test(e)})),`Свойство сущности ${ee} "expire_date_time" должно быть датой в формате ISO`]]},deleted:{validators:[[V(G),Y(ee,"deleted")]]},completed:{validators:[[V(G),Y(ee,"completed")]]}},ae=e=>B(e,te,F,ee);function ne(e){const{task_id:t,title:a,priority_id:n,category_id:r,description:i,expire_date_time:s,deleted:o,completed:c}=e||{};return{task_id:t,title:a,priority_id:n,category_id:r,description:i,expire_date_time:s,deleted:o,completed:c}}const re={task_id:{validators:[[U,D(ee,"task_id")]],required:!0},...te},ie=e=>B(e,re,ne,ee);e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p;function se(e){return"string"==typeof e}function oe(e,t){return`Свойство сущности ${e} "${t}" должно быть строкой`}function ce(e){return t=>e.includes(t)}function de(e,t){return`Свойство сущности ${e} "${t}" должно быть значением из списка`}const ue="others",le="settings",fe="Настройки",pe="about",ge="О Приложении",ye="store_state",me="Разработчикам",_e=[le,ye,pe],he=[fe,ge,me];const we="Навигационный фильтр",be=(oe(we,"title"),ce(_e),de(we,"title"),oe(we,"title"),ce(he),de(we,"title"),oe(we,"type"),"filter"),ke="inbox",ve="Черновики",xe="trash",Se="Корзина",Oe="expired",je="Просроченные",Re="completed",$e="Завершенные",qe=[ke,Oe,Re,xe],Te=[ve,Se,je,$e];const We="Навигационный фильтр",Ie=(oe(We,"title"),ce(qe),de(We,"title"),oe(We,"title"),ce(Te),de(We,"title"),oe(We,"type"),"calendar");const Ee="Навигационный фильтр",Ae=(D(Ee,"key"),oe(Ee,"type"),"category");const Le="Навигационный фильтр";D(Le,"key"),oe(Le,"type");function Ne(e,t,a){return void 0===a&&(a=200),new Response(JSON.stringify({id:e,result:t}),{headers:c,status:a})}class Pe{constructor(e,t){this.type=e,this.data=t}}async function Ue(e,a){t.clients.matchAll().then((t=>{t.forEach((t=>{t.id!==e&&t.postMessage(a)}))}))}async function De(e){const{request:t}=e,a=k(),{id:n,params:r}=await t.json(),i=await async function(e,t){const a=ae(t);if(!a.error){const n=a.result;if(!e.priorities.find((e=>e.priority_id===n.priority_id)))return{error:{message:"Не известный идентификатор приоритета",data:t}};if(!e.categories.find((e=>e.category_id===n.category_id)))return{error:{message:"Не известный идентификатор категории",data:t}};const r=e.tasks.at(-1)?.task_id||0,i={...n,task_id:r+1};return e.tasks.push(i),{result:i}}return a}(a,r);if(i.result){const t=i.result;return await v(a),await Ue(e.clientId,new Pe("create_task",t)),Ne(n,t)}return W(n,i.error.message,i.error.data)}async function He(e){const{request:t}=e,a=k(),{id:n,params:r}=await t.json(),i=await async function(e,t){const a=ie(t);if(a.result){const n=a.result,r=e.tasks.findIndex((e=>e.task_id===n.task_id));return-1===r?{error:{message:"Задача не найдена",data:t}}:e.priorities.find((e=>e.priority_id===n.priority_id))?e.categories.find((e=>e.category_id===n.category_id))?(e.tasks[r]=n,{result:n}):{error:{message:"Не известный идентификатор категории",data:t}}:{error:{message:"Не известный идентификатор приоритета",data:t}}}return a}(a,r);if(i.result){const t=i.result;return await v(a),await Ue(e.clientId,new Pe("update_task",t)),Ne(n,t)}return W(n,i.error.message,i.error.data)}function Je(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const a=Object.keys(e),n=Object.keys(t);return a.length===n.length&&a.every((a=>n.includes(a)&&Je(e[a],t[a])))}async function Be(e){const{request:t}=e,a=k(),{id:n,params:r}=await t.json(),i=await async function(e,t){const a=ie(t);if(a.result){const n=a.result,r=e.tasks.findIndex((e=>Je(ne(e),ne(n))));return-1===r?{error:{message:"Задача не найдена",data:t}}:(e.tasks.splice(r,1),{result:n})}return a}(a,r);if(i.result){const t=i.result;return await v(a),await Ue(e.clientId,new Pe("delete_task",t)),Ne(n,t)}return W(n,i.error.message,i.error.data)}async function Ke(e){const{request:t}=e,a=k(),{id:n,params:r}=await t.json(),i=await async function(e,t){const a=M(t);if(a.result){const n=a.result,r=e.categories.find((e=>e.category_name===n.category_name));if(r)return{error:{message:"Категория с таким именем уже существует",data:t}};if(!e.icons.find((e=>e.icon_id===n.icon_id)))return{error:{message:"Не известный идентификатор иконки",data:t}};const i=e.categories.at(-1)?.category_id||0,s={...n,category_id:i+1};return e.categories.push(s),{result:s}}return a}(a,r);if(i.result){const t=i.result;return await v(a),await Ue(e.clientId,new Pe("create_category",t)),Ne(n,t)}return W(n,i.error.message,i.error.data)}async function Ze(e){const{request:t}=e,a=k(),{id:n,params:r}=await t.json(),i=await async function(e,t){const a=Q(t);if(a.result){const n=a.result;let r=e.categories.findIndex((e=>e.category_id===n.category_id));return-1===r?{error:{message:"Категория не найдена",data:t}}:e.categories.find((e=>e.category_name===n.category_name&&e.category_id!==n.category_id))?{error:{message:"Категория с таким именем уже существует",data:t}}:e.icons.find((e=>e.icon_id===n.icon_id))?(r=e.categories.findIndex((e=>e.category_id===n.category_id)),e.categories[r]=n,{result:n}):{error:{message:"Не известный идентификатор иконки",data:t}}}return a}(a,r);if(i.result){const t=i.result;return v(a),await Ue(e.clientId,new Pe("update_category",t)),Ne(n,t)}return W(n,i.error.message,i.error.data)}async function Ce(e){const{request:t}=e,a=k(),{id:n,params:r}=await t.json(),i=await async function(e,t){const a=Q(t);if(a.result){const n=a.result,r=e.categories.findIndex((e=>Je(e,n)));return-1===r?{error:{message:"Категория не найдена",data:t}}:e.tasks.find((e=>e.category_id===n.category_id))?{error:{message:"Категория используется в задачах",data:t}}:(e.categories.splice(r,1),{result:n})}return a}(a,r);if(i.result){const t=i.result;return v(a),await Ue(e.clientId,new Pe("delete_category",t)),Ne(n,t)}return W(n,i.error.message,i.error.data)}async function Me(e,t){switch(t){case o:return async function(e){const{request:t}=e,a=await O(),n=t.headers.get("x-request-id");return new Response(JSON.stringify({id:n,result:a}),{headers:c,status:200})}(e);case u:return Ke(e);case l:return Ze(e);case f:return Ce(e);case p:return De(e);case g:return He(e);case y:return Be(e);case"/log/info":case"/log/warn":case"/log/error":return async function(e){const{request:t}=e,a=(await t.json()).id||P();return new Response(JSON.stringify({id:a,result:"Ok"}),{headers:c,status:200})}(e);default:return new Response(JSON.stringify({error:{code:404,error:"Not found"}}),{headers:c,status:200})}}t.id=Date.now(),t.VERSION="1.0.10",t.assets=q,t.isRepearing=!1,t.logger=$,t.onerror=T,t.addEventListener("message",(function(e){e.data&&"SKIP_WAITING"===e.data.type&&t.skipWaiting()})),t.addEventListener("fetch",(async function(e){const a=e.request,n=function(e){const{pathname:t}=new URL(e);return t.startsWith(s)?t.slice(s.length):t}(a.url);switch(a.method){case"GET":return async function(){const e=await caches.open(r),a=(await e.keys()).map((e=>new URL(e.url).pathname)),n=t.assets.filter((e=>!a.includes(e)&&!e.startsWith("/offline.")));if(n.length>0&&!t.isRepearing){t.isRepearing=!0;try{await e.addAll(n)}finally{t.isRepearing=!1}}}(),void await async function(e,a){if("document"!==e.request.destination||a!==E)t.assets.includes(a)&&e.respondWith(N(0,e.request.url,a));else{const a=t.assets.find((e=>e.startsWith(`${E}offline.`)&&e.endsWith(".html")))||"";e.respondWith(N(0,a,a))}}(e,n);case"POST":{const t=()=>Me(e,n);return void await async function(e,t,a){if(m.includes(t)){const e=k();e.icons&&0===e.icons.length&&await O()}e.respondWith(a())}(e,n,t)}default:e.respondWith(W(-1,"Не допустимый http метод"))}})),t.addEventListener("install",(async function(e){e.waitUntil(async function(){const e=await caches.open(r),a=(await e.keys()).map((e=>new URL(e.url).pathname)),n=t.assets.filter((e=>!a.includes(e)));t.loadedAssets=n,n.length>0&&await e.addAll(n)}())})),t.addEventListener("activate",(async function(e){e.waitUntil(j()),e.waitUntil(t.clients.claim())}))}();
>>>>>>> 5e2f53ff40ea4a242acd55b23d27b3a820c388d0
