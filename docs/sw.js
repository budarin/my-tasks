<<<<<<< HEAD
(()=>{"use strict";const e=self,t=200,s=206,a="assets",r="Content-Security-Policy",n=["js","css","webmanifest","json","html"];const i="/api/",o="get_tasks",c={"Content-Type":"application/json; charset=utf-8"},d="RELOAD_PAGE",u="create_category",l="update_category",f="delete_category",g="create_task",p="update_task",m="delete_task",y="clear_tasks",_="import_tasks";const h="tasks",w="kv-storage";async function b(e){if(e.icons&&e.icons.length>0){let t;const s=JSON.stringify(e),a=await caches.open(w),r=await a.match(h);void 0!==r&&(t=await r.text()),void 0!==r&&t===s||await a.put(h,new Response(s,{headers:new Headers({...c,"Content-Length":String(s.length)})}))}}let k={tasks:[],categories:[],priorities:[],icons:[]};function v(){return k}async function x(e){k=e,await b(e)}const q={icons:[{icon_id:1,file_name:"page.png"},{icon_id:2,file_name:"home.png"},{icon_id:3,file_name:"other.png"},{icon_id:4,file_name:"warning.png"},{icon_id:5,file_name:"alert.png"},{icon_id:6,file_name:"ball.png"},{icon_id:7,file_name:"bug.png"},{icon_id:8,file_name:"cart.png"},{icon_id:9,file_name:"favorite.png"},{icon_id:10,file_name:"inbox.png"},{icon_id:11,file_name:"life.png"},{icon_id:12,file_name:"mail.png"},{icon_id:13,file_name:"twitter.png"},{icon_id:14,file_name:"note.png"},{icon_id:15,file_name:"refresh.png"},{icon_id:16,file_name:"next.png"},{icon_id:17,file_name:"today.png"}],priorities:[{priority_id:1,priority_name:"обычный"},{priority_id:2,priority_name:"повышенный"},{priority_id:3,priority_name:"высокий"}],categories:[{category_id:2,icon_id:2,category_name:"Дом"},{category_id:1,icon_id:3,category_name:"Работа"}],tasks:[]};async function $(){let e=v();const t=await caches.open(w),s=await t.match(h);if(e.icons&&0===e.icons.length){if(void 0!==s){const t=await s.json();if(t)return e=t,await x(e),e}if(e.icons&&0===e.icons.length)return await x(q),q}return s||await b(e),e}async function j(){await async function(){const t=await caches.open(a);let s=(await t.keys()).map((e=>new URL(e.url).pathname));const r=s.filter((t=>!e.assets.includes(t)));r.length>0&&await Promise.all(r.map((async e=>{await t.delete(e),s=s.filter((t=>t!==e))})));const i=e.assets.filter((e=>{const t=e.split(".").pop()||"";return n.includes(t)&&!s.includes(e)}));i.length>0&&await t.addAll(i)}(),await $(),await async function(){e.clients.matchAll().then((e=>{e.forEach((e=>e.postMessage({type:d})))}))}()}const I=e=>{const t=()=>{throw new Error(e||"Попытка обратиться к неинициализированному сервису.")};return new Proxy((()=>{}),{get:t,apply:t})};let R=I(`Попытка обратиться к неинициализированному сервису ${"swLogger"}`);let N=(e=>I(`Попытка обратиться к неинициализированному DI сервиса ${e}`))("browser");const S=["/my-tasks/alert.476b00abda902b398be7.png","/my-tasks/android-chrome-192x192.1cfc30bbcbf340fc741d.png","/my-tasks/android-chrome-512x512.558e975c145ffb2a28fd.png","/my-tasks/android-chrome-maskable-192x192.126708023a549b771f76.png","/my-tasks/android-chrome-maskable-512x512.d40a692f812ed7f5e7e3.png","/my-tasks/app.0c9707c59eb8ca167dd1.js","/my-tasks/apple-touch-icon.7cb6aa9a5fc2e73f0df5.png","/my-tasks/ball.3d996bafa729a1d3f580.png","/my-tasks/bug.83b52ad3ded9ef1fbd18.png","/my-tasks/cart.2d640112b4b86b627ff7.png","/my-tasks/error.8ad17092b67f41ed6f08.mp3","/my-tasks/expired.45d759abb485d88b78aa.svg","/my-tasks/favicon-32x32.88ac8115acd8f90a85e8.png","/my-tasks/favicon.31159ba4d345a313888e.ico","/my-tasks/favorite.7f0174c25660ef72df60.png","/my-tasks/help.07e68c4e1a7f5c4cf69c.png","/my-tasks/help.83136d93df7a9872ae11.svg","/my-tasks/home.3e40fe2b97b19c75dfaf.png","/my-tasks/icon.3e6067cba439e4ebbe1b.svg","/my-tasks/inbox.58a834f614e341f9c578.png","/my-tasks/install-narrow1.5fd4be916f60a603a2f2.png","/my-tasks/install-narrow2.c310a9844a7be437477c.png","/my-tasks/install-pwa.3d7d93affc3b234a02a9.png","/my-tasks/install-wide.6c346932ecfd0d529b06.png","/my-tasks/life.5896aaa56394aa0273b3.png","/my-tasks/locked.4ca6e2c7ddf27e00ee5f.png","/my-tasks/mail.4a4239588f1b0d37bcfc.png","/my-tasks/main.e2d5c62bafe2cac9b88e.js","/my-tasks/next.4b695e6dc3fabdcc84b4.png","/my-tasks/note.8e112a51a84fa9c09b11.png","/my-tasks/note5.abc5ade9f6cd6928e96d.png","/my-tasks/npms.d81051982826595114aa.js","/my-tasks/other.66c872e04e2846cafa68.png","/my-tasks/page.9d1fc4484b1e5929b7ee.png","/my-tasks/refresh.7c9f0768269a6bbec081.png","/my-tasks/runtime.311b03f45d5f56aa159a.js","/my-tasks/settings.231ef2d68a51da6cad41.svg","/my-tasks/share.ffc5f2b689d17d39785e.svg","/my-tasks/social.74d1f2af4215f43e0288.png","/my-tasks/state.c56984d48249544ade49.svg","/my-tasks/today.141e3d87afbd71da541c.png","/my-tasks/trash.3e03c195726c2cccdc94.gif","/my-tasks/twitter.5556cda0273e796d6a65.png","/my-tasks/unlocked.737119d4563135ccd8c0.png","/my-tasks/warning.4f48c087dcbbdb3bd268.png","/my-tasks/manifest.d1c187eb2420adf8e31782026282a33b.webmanifest","/my-tasks/offline.d525bc60b18801ec12a5ed6d4de5a503.html"];function T(e){}function L(e,t,s){return new Response(JSON.stringify({id:e,error:{code:500,message:t,data:s}}),{headers:c,status:200})}function A(){return N.navigator.userAgent.toLowerCase().includes("chrome")||N.navigator.userAgent.toLowerCase().includes("chromium")}const O="/my-tasks/",W=e=>e.startsWith(`${O}offline.`)&&e.endsWith(".html"),C="default-src 'none'; base-uri 'none'; object-src 'none'; connect-src 'self' https://budarinv.ru; media-src 'self'; manifest-src 'self'; img-src 'self' data: ; worker-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'sha384-J0gYDrIaXmSwJHoBIceuTJaPP1fQlZBXIKzt4pA3rwiSN--DRXL_XuQj3_htMm-g' 'sha384-Ul13hXxd26CuGKdSBqjdxgWgvOJ0LujQd8PL_Qms8nl8pC94Ey-zBvlEhpvMv9Na' 'sha384-BKwYz_eFcwZBLFQ0N4iAy4Bpm3pOpwoWWbHz92Fg_FxQsB989eTGs53LRJMoptdu' 'sha384-El-VUQMDWcMUTozokQpFUqYWgcwKQIQSTlnj9N1gN_ZDk8_QOFMJt3uua7eH_5OC' 'sha384-Zj9NV0H7oH8KHW9o3nhwP8Ts0hhyz7OT0qegQ5WFixABR4VIpmyivIVSpuel_TTZ' 'sha384-HLDdh5uJfs9UKP8mqnYbUKICb59iqfrCMgSuybR5hV9slXuLgpcl91nKmzEcqOht'; font-src 'self' data:; require-trusted-types-for 'script'; trusted-types webpack-tt svg-policy default;";async function U(n,i,o){const c=await caches.open(a),d=await c.match(i);if(d){if(W(i)&&!d.headers.get(r)){const e=d.clone(),t=new Headers(d.headers);t.set(r,C);try{let s=await d.text();A()&&(s=s.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""));const a=new Response(s,{status:e.status,statusText:e.statusText,headers:t});return await c.put(i,a.clone()),a}catch(e){return d}}return d}return async function(n,i){let o;const c=await fetch(n,{keepalive:!0});if(null===c.body)return c;const d=new Headers(c.headers);if(c.status===s){const e=await c.blob(),t=await e.arrayBuffer();o=new Response(t,{headers:d})}else{let e;W(n)?(e=await c.text(),d.set(r,C),A()&&(e=e.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""))):e=await c.blob(),o=new Response(e,{headers:d,status:c.status,statusText:c.statusText})}const u=o.status===t;if(!1===u)return c;u&&e.assets.includes(i)&&(await caches.open(a)).put(n,o.clone());return o}(i,o)}function E(e=Date.now()){const t=new Uint8Array(10);!function(e){if(void 0!==globalThis.crypto&&"function"==typeof globalThis.crypto.getRandomValues)return globalThis.crypto.getRandomValues(e);if("function"==typeof require){const t=require("crypto").randomBytes(e.length);return e.set(t),e}throw new Error("Secure random number generation is not supported in this environment.")}(t);const s=e.toString(16).padStart(12,"0"),a=function(e){let t="";for(let s=0;s<e.length;s++){const a=e[s].toString(16);t+=2===a.length?a:"0"+a}return t}(t);return`${s.substring(0,8)}-${s.substring(8)}-${a.substring(0,4)}-${a.substring(4,8)}-${a.substring(8)}`}function J(e,t=65536){return s=>{if("string"!=typeof s)return!1;const a=String(s).trim();return a.length>=e&&a.length<=t}}const P=(e,t,s,a)=>`Свойство сущности ${e} "${t}" должно быть строкой длиной от ${s} до ${a} символов`;function Q(e){const t=Number(e);return"number"==typeof t&&Number.isInteger(t)}const V=(e,t)=>`Свойство сущности ${e} "${t}" должно быть целым числом`;function B(e){return t=>void 0===t||e(t)}function H(e){return"boolean"==typeof e}function M(e,t){return`Свойство сущности ${e} "${t}" должно быть undefined или boolean`}const D=(e,t,s,a)=>{const r={error:{message:`Сущность "${a}" должна быть объектом`,data:e}};if(void 0===e)return r;if(!1===function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}(e))return r;const n=e,i=Object.keys(t);for(let e=0;e<i.length;e++){const s=i[e],r=t[s];if(!0===r.required&&void 0===n[s])return{error:{message:`Свойство "${s}" сущности ${a} отсутствует`,data:n}};for(let e=0;e<r.validators.length;e++){const t=r.validators[e];if(!1===t[0](n[s]))return{error:{message:t[1],data:n}}}}return{result:s(n)}},K=e=>{e.currentTarget.setCustomValidity("")},z=(e,t,s)=>a=>{const r=a.currentTarget;let n=`Поле "${e}" обязательно для заполнения`;const i=r.value.replace(/\n/gm,"").trim();return r.validity.patternMismatch?(n=`Поле "${e}" должно начинаться с минимум ${t} символов, исключая спецсимволы и пробелы`,void r.setCustomValidity(n)):i&&(i.length<t||i.length>s)?(n=`Поле "${e}" должно содержать минимум ${t} и максимум ${s} символов`,void r.setCustomValidity(n)):void r.setCustomValidity(n)};function F(e){if(e)return e[0].toUpperCase()+e.slice(1).toLowerCase()}const X="Задача",Z=100,G="Название задачи";z(G,3,Z);function Y(e){const{title:t,priority_id:s,category_id:a,description:r,expire_date_time:n,deleted:i,completed:o}=e||{};return{title:F(t.trim()),priority_id:Number(s),category_id:a?Number(a):void 0,description:r?.replace(/\s*\n+\s*$/,"").trim(),expire_date_time:n,deleted:i,completed:o}}const ee={title:{validators:[[J(3,Z),P(X,"title",3,Z)]],required:!0},priority_id:{validators:[[Q,V(X,"priority_id")]],required:!0},category_id:{validators:[[B(Q),function(e,t){return`Свойство сущности ${e} "${t}" должно быть undefined или целым числом`}(X,"category_id")]]},expire_date_time:{validators:[[B((function(e){return"string"==typeof e})),function(e,t){return`Свойство сущности ${e} "${t}" должно быть строкой`}(X,"expire_date_time")],[B((function(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/.test(e)})),`Свойство сущности ${X} "expire_date_time" должно быть датой в формате ISO`]]},deleted:{validators:[[B(H),M(X,"deleted")]]},completed:{validators:[[B(H),M(X,"completed")]]}},te=e=>D(e,ee,Y,X);function se(e){const{task_id:t,title:s,priority_id:a,category_id:r,description:n,expire_date_time:i,deleted:o,completed:c}=e||{};return{task_id:Number(t),title:F(s.trim()),priority_id:Number(a),category_id:r?Number(r):void 0,description:n,expire_date_time:i,deleted:o,completed:c}}const ae={task_id:{validators:[[Q,V(X,"task_id")]],required:!0},...ee},re=e=>D(e,ae,se,X);function ne(e,t,s=200){return new Response(JSON.stringify({id:e,result:t}),{headers:c,status:s})}class ie{constructor(e,t){this.type=e,this.data=t}}async function oe(t,s){e.clients.matchAll().then((e=>{e.forEach((e=>{e.id!==t&&e.postMessage(s)}))}))}function ce(e,t){const s=te(t);if(!s.error){const a=s.result;if(!e.priorities.find((e=>e.priority_id===a.priority_id)))return{error:{message:"Не известный идентификатор приоритета",data:t}};if(a.category_id){if(!e.categories.find((e=>e.category_id===a.category_id)))return{error:{message:"Не известный идентификатор категории",data:t}}}const r=e.tasks.at(-1)?.task_id||0,n={...a,task_id:r+1};return e.tasks.push(n),{result:n}}return s}function de(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const s=Object.keys(e),a=Object.keys(t);return s.length===a.length&&s.every((s=>a.includes(s)&&de(e[s],t[s])))}const ue="Категория",le="Название категории";z(le,3,20);function fe(e){const{icon_id:t,category_name:s}=e||{};return{icon_id:Number(t),category_name:F(s.trim())}}const ge={icon_id:{validators:[[Q,V(ue,"icon_id")]],required:!0},category_name:{validators:[[J(3,20),P(ue,"category_name",3,20)]],required:!0}},pe=e=>D(e,ge,fe,ue);function me(e){const{category_id:t,icon_id:s,category_name:a}=e||{};return{category_id:Number(t),icon_id:Number(s),category_name:F(a.trim())}}const ye={category_id:{validators:[[Q,V(ue,"category_id")]],required:!0},...ge},_e=e=>D(e,ye,me,ue);function he(e,t){const s=pe(t);if(s.result){const a=s.result,r=e.categories.find((e=>e.category_name===a.category_name));if(r)return{error:{message:"Категория с таким именем уже существует",data:t}};if(!e.icons.find((e=>e.icon_id===a.icon_id)))return{error:{message:"Не известный идентификатор иконки",data:t}};const n=e.categories.at(-1)?.category_id||0,i={...a,category_id:n+1};return e.categories.push(i),{result:i}}return s}function we(e){const t=(s=e.tasks,"structuredClone"in globalThis?N.structuredClone(s):s);var s;return e.tasks=[],{result:t}}function be(){return Promise.resolve(new Response(JSON.stringify({error:{code:404,error:"Not found"}}),{headers:c,status:200}))}async function ke(e){const{request:t}=e,s=(await t.json()).id||E();return new Response(JSON.stringify({id:s,result:"Ok"}),{headers:c,status:200})}const ve={[o]:async function(e){const{request:t}=e,s=await $(),a=t.headers.get("x-request-id");return new Response(JSON.stringify({id:a,result:s}),{headers:c,status:200})},[u]:async function(e){const{request:t}=e,s=v(),{id:a,params:r}=await t.json(),n=he(s,r);if(n.result){const t=n.result;return await x(s),await oe(e.clientId,new ie("create_category",t)),ne(a,t)}return L(a,n.error.message,n.error.data)},[l]:async function(e){const{request:t}=e,s=v(),{id:a,params:r}=await t.json(),n=function(e,t){const s=_e(t);if(s.result){const a=s.result;let r=e.categories.findIndex((e=>e.category_id===a.category_id));return-1===r?{error:{message:"Категория не найдена",data:t}}:e.categories.find((e=>e.category_name===a.category_name&&e.category_id!==a.category_id))?{error:{message:"Категория с таким именем уже существует",data:t}}:e.icons.find((e=>e.icon_id===a.icon_id))?(r=e.categories.findIndex((e=>e.category_id===a.category_id)),e.categories[r]=a,{result:a}):{error:{message:"Не известный идентификатор иконки",data:t}}}return s}(s,r);if(n.result){const t=n.result;return x(s),await oe(e.clientId,new ie("update_category",t)),ne(a,t)}return L(a,n.error.message,n.error.data)},[f]:async function(e){const{request:t}=e,s=v(),{id:a,params:r}=await t.json(),n=function(e,t){const s=_e(t);if(s.result){const a=s.result,r=e.categories.findIndex((e=>de(e,a)));return-1===r?{error:{message:"Категория не найдена",data:t}}:e.tasks.find((e=>e.category_id===a.category_id))?{error:{message:"Категория используется в задачах",data:t}}:(e.categories.splice(r,1),{result:a})}return s}(s,r);if(n.result){const t=n.result;return x(s),await oe(e.clientId,new ie("delete_category",t)),ne(a,t)}return L(a,n.error.message,n.error.data)},[g]:async function(e){const{request:t}=e,s=v(),{id:a,params:r}=await t.json(),n=ce(s,r);if(n.result){const t=n.result;return await x(s),await oe(e.clientId,new ie(g,t)),ne(a,t)}return L(a,n.error.message,n.error.data)},[p]:async function(e){const{request:t}=e,s=v(),{id:a,params:r}=await t.json(),n=function(e,t){const s=re(t);if(s.result){const a=s.result,r=e.tasks.findIndex((e=>e.task_id===a.task_id));return-1===r?{error:{message:"Задача не найдена",data:t}}:e.priorities.find((e=>e.priority_id===a.priority_id))?a.category_id&&!e.categories.find((e=>e.category_id===a.category_id))?{error:{message:"Не известный идентификатор категории",data:t}}:(e.tasks[r]=a,{result:a}):{error:{message:"Не известный идентификатор приоритета",data:t}}}return s}(s,r);if(n.result){const t=n.result;return await x(s),await oe(e.clientId,new ie(p,t)),ne(a,t)}return L(a,n.error.message,n.error.data)},[m]:async function(e){const{request:t}=e,s=v(),{id:a,params:r}=await t.json(),n=function(e,t){const s=re(t);if(s.result){const a=s.result,r=e.tasks.findIndex((e=>de(se(e),se(a))));return-1===r?{error:{message:"Задача не найдена",data:t}}:(e.tasks.splice(r,1),{result:a})}return s}(s,r);if(n.result){const t=n.result;return await x(s),await oe(e.clientId,new ie(m,t)),ne(a,t)}return L(a,n.error.message,n.error.data)},[y]:async function(e){const{request:t}=e,s=v(),{id:a}=await t.json(),r=we(s);if(r.result){const t=r.result;return await x(s),await oe(e.clientId,new ie(y)),ne(a,t)}return L(a,r.error.message,r.error.data)},[_]:async function(e){const{request:t}=e,s={failed:{categories:[],tasks:[]},imported:{categories:[],tasks:[]}},a={categories:[]},{id:r,params:n}=await t.json();if(n){const t=v(),{tasks:i,categories:o}=n;if(!(i&&Array.isArray(i)&&o&&Array.isArray(o)))return L(r,"Не валидные данные");for(let e=0;e<i.length;e++){const r=i[e];let n;if(r.category_id){const e=o.find((e=>e.category_id===r.category_id));e&&(a.categories.includes(e.category_name)||(n=he(t,e),n.error?s.failed.categories.push(n.error):s.imported.categories.push(n.result),a.categories.push(e.category_name)))}t.tasks.find((e=>e.title===r.title&&e.description===r.description&&e.priority_id===r.priority_id&&e.category_id===r.category_id&&e.completed==r.completed&&e.deleted==r.deleted&&e.expire_date_time==r.expire_date_time))?s.failed.tasks.push({message:"Задача уже существует",data:r}):(n=ce(t,r),n.error?s.failed.tasks.push(n.error):s.imported.tasks.push(n.result))}(s.imported.categories.length>0||s.imported.tasks.length>0)&&x(t);const c=s.imported;return(c.categories.length>0||c.tasks.length>0)&&await oe(e.clientId,new ie(_,s.imported)),ne(r,s)}return L(r,"Не удалось импортировать задачи")},"/log/info":ke,"/log/warn":ke,"/log/error":ke};async function xe(e,t){const s=async function(e,t){return 0===v().icons.length&&await $(),(ve[t]||be)(e)}(e,t);return s}var qe;qe=globalThis,N=qe,e.id=Date.now(),e.VERSION="1.22.33",e.assets=S,e.isRepearing=!1,e.logger=R,e.onerror=T,e.addEventListener("message",(function(t){t.data&&"SKIP_WAITING"===t.data.type&&e.skipWaiting()})),e.addEventListener("fetch",(async function(t){const s=t.request,r=function(e){const{pathname:t}=new URL(e);return t.startsWith(i)?t.slice(i.length):t}(s.url);switch(s.method){case"GET":return await async function(t,s){if("document"!==t.request.destination||s!==O)e.assets.includes(s)&&t.respondWith(U(0,t.request.url,s));else{const s=e.assets.find((e=>e.startsWith(`${O}offline.`)&&e.endsWith(".html")))||"";t.respondWith(U(0,s,s))}}(t,r),void t.waitUntil(async function(){const t=await caches.open(a),s=(await t.keys()).map((e=>new URL(e.url).pathname)),r=e.assets.filter((e=>!s.includes(e)&&!e.startsWith("/offline.")));if(r.length>0&&!e.isRepearing){e.isRepearing=!0;try{await t.addAll(r)}finally{e.isRepearing=!1}}}());case"POST":{const{origin:e}=new URL(t.request.referrer);if(!t.request.url.startsWith(e))return;if(t.request.url.indexOf("/ai/")>0)return;return void t.respondWith(xe(t,r))}default:t.respondWith(L(-1,"Не допустимый http метод"))}})),e.addEventListener("install",(async function(t){t.waitUntil(async function(){const t=await caches.open(a),s=(await t.keys()).map((e=>new URL(e.url).pathname)),r=e.assets.filter((e=>{const t=e.split(".").pop()||"";return n.includes(t)&&!s.includes(e)}));e.loadedAssets=r,r.length>0&&await t.addAll(r)}())})),e.addEventListener("activate",(async function(t){t.waitUntil(j()),t.waitUntil(e.clients.claim())}))})();
=======
(()=>{"use strict";const e=self,t=200,a=206,s="assets",r="Content-Security-Policy",n=["js","css","webmanifest","json","html"];const i="/api/",o="get_tasks",c={"Content-Type":"application/json; charset=utf-8"},d="RELOAD_PAGE",u="create_category",l="update_category",f="delete_category",g="create_task",p="update_task",m="delete_task",y="clear_tasks",_="import_tasks";const h="tasks",w="kv-storage";async function b(e){if(e.icons&&e.icons.length>0){let t;const a=JSON.stringify(e),s=await caches.open(w),r=await s.match(h);void 0!==r&&(t=await r.text()),void 0!==r&&t===a||await s.put(h,new Response(a,{headers:new Headers({...c,"Content-Length":String(a.length)})}))}}let k={tasks:[],categories:[],priorities:[],icons:[]};function v(){return k}async function x(e){k=e,await b(e)}const q={icons:[{icon_id:1,file_name:"page.png"},{icon_id:2,file_name:"home.png"},{icon_id:3,file_name:"other.png"},{icon_id:4,file_name:"warning.png"},{icon_id:5,file_name:"alert.png"},{icon_id:6,file_name:"ball.png"},{icon_id:7,file_name:"bug.png"},{icon_id:8,file_name:"cart.png"},{icon_id:9,file_name:"favorite.png"},{icon_id:10,file_name:"inbox.png"},{icon_id:11,file_name:"life.png"},{icon_id:12,file_name:"mail.png"},{icon_id:13,file_name:"twitter.png"},{icon_id:14,file_name:"note.png"},{icon_id:15,file_name:"refresh.png"},{icon_id:16,file_name:"next.png"},{icon_id:17,file_name:"today.png"}],priorities:[{priority_id:1,priority_name:"обычный"},{priority_id:2,priority_name:"повышенный"},{priority_id:3,priority_name:"высокий"}],categories:[{category_id:2,icon_id:2,category_name:"Дом"},{category_id:1,icon_id:3,category_name:"Работа"}],tasks:[]};async function j(){let e=v();const t=await caches.open(w),a=await t.match(h);if(e.icons&&0===e.icons.length){if(void 0!==a){const t=await a.json();if(t)return e=t,await x(e),e}if(e.icons&&0===e.icons.length)return await x(q),q}return a||await b(e),e}async function $(){await async function(){const t=await caches.open(s);let a=(await t.keys()).map((e=>new URL(e.url).pathname));const r=a.filter((t=>!e.assets.includes(t)));r.length>0&&await Promise.all(r.map((async e=>{await t.delete(e),a=a.filter((t=>t!==e))})));const i=e.assets.filter((e=>{const t=e.split(".").pop()||"";return n.includes(t)&&!a.includes(e)}));i.length>0&&await t.addAll(i)}(),await j(),await async function(){e.clients.matchAll().then((e=>{e.forEach((e=>e.postMessage({type:d})))}))}()}const N=e=>{const t=()=>{throw new Error(e||"Попытка обратиться к неинициализированному сервису.")};return new Proxy((()=>{}),{get:t,apply:t})};let A=N(`Попытка обратиться к неинициализированному сервису ${"swLogger"}`);let I=(e=>N(`Попытка обратиться к неинициализированному DI сервиса ${e}`))("browser");const R=["/my-tasks/alert.476b00abda902b398be7.png","/my-tasks/android-chrome-192x192.1cfc30bbcbf340fc741d.png","/my-tasks/android-chrome-512x512.558e975c145ffb2a28fd.png","/my-tasks/android-chrome-maskable-192x192.126708023a549b771f76.png","/my-tasks/android-chrome-maskable-512x512.d40a692f812ed7f5e7e3.png","/my-tasks/app.8bc269ce7ff1b7141688.js","/my-tasks/apple-touch-icon.7cb6aa9a5fc2e73f0df5.png","/my-tasks/ball.3d996bafa729a1d3f580.png","/my-tasks/bug.83b52ad3ded9ef1fbd18.png","/my-tasks/cart.2d640112b4b86b627ff7.png","/my-tasks/error.8ad17092b67f41ed6f08.mp3","/my-tasks/expired.45d759abb485d88b78aa.svg","/my-tasks/favicon-32x32.88ac8115acd8f90a85e8.png","/my-tasks/favicon.31159ba4d345a313888e.ico","/my-tasks/favorite.7f0174c25660ef72df60.png","/my-tasks/help.07e68c4e1a7f5c4cf69c.png","/my-tasks/help.83136d93df7a9872ae11.svg","/my-tasks/home.3e40fe2b97b19c75dfaf.png","/my-tasks/icon.3e6067cba439e4ebbe1b.svg","/my-tasks/inbox.58a834f614e341f9c578.png","/my-tasks/install-narrow1.5fd4be916f60a603a2f2.png","/my-tasks/install-narrow2.c310a9844a7be437477c.png","/my-tasks/install-pwa.3d7d93affc3b234a02a9.png","/my-tasks/install-wide.6c346932ecfd0d529b06.png","/my-tasks/life.5896aaa56394aa0273b3.png","/my-tasks/locked.4ca6e2c7ddf27e00ee5f.png","/my-tasks/mail.4a4239588f1b0d37bcfc.png","/my-tasks/main.e2d5c62bafe2cac9b88e.js","/my-tasks/next.4b695e6dc3fabdcc84b4.png","/my-tasks/note.8e112a51a84fa9c09b11.png","/my-tasks/note5.abc5ade9f6cd6928e96d.png","/my-tasks/npms.d81051982826595114aa.js","/my-tasks/other.66c872e04e2846cafa68.png","/my-tasks/page.9d1fc4484b1e5929b7ee.png","/my-tasks/refresh.7c9f0768269a6bbec081.png","/my-tasks/runtime.0d52a1be84588fab8c17.js","/my-tasks/settings.231ef2d68a51da6cad41.svg","/my-tasks/share.ffc5f2b689d17d39785e.svg","/my-tasks/social.74d1f2af4215f43e0288.png","/my-tasks/state.c56984d48249544ade49.svg","/my-tasks/today.141e3d87afbd71da541c.png","/my-tasks/trash.3e03c195726c2cccdc94.gif","/my-tasks/twitter.5556cda0273e796d6a65.png","/my-tasks/unlocked.737119d4563135ccd8c0.png","/my-tasks/warning.4f48c087dcbbdb3bd268.png","/my-tasks/manifest.d1c187eb2420adf8e31782026282a33b.webmanifest","/my-tasks/offline.1bc91af9ee5d1f59adfcbefb30bbfe64.html"];function S(e){}function L(e,t,a){return new Response(JSON.stringify({id:e,error:{code:500,message:t,data:a}}),{headers:c,status:200})}function T(){return I.navigator.userAgent.toLowerCase().includes("chrome")||I.navigator.userAgent.toLowerCase().includes("chromium")}const O="/my-tasks/",C=e=>e.startsWith(`${O}offline.`)&&e.endsWith(".html"),W="default-src 'none'; base-uri 'none'; object-src 'none'; connect-src 'self' https://budarinv.ru; media-src 'self'; manifest-src 'self'; img-src 'self' data: ; worker-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'sha384-J0gYDrIaXmSwJHoBIceuTJaPP1fQlZBXIKzt4pA3rwiSN--DRXL_XuQj3_htMm-g' 'sha384-Ul13hXxd26CuGKdSBqjdxgWgvOJ0LujQd8PL_Qms8nl8pC94Ey-zBvlEhpvMv9Na' 'sha384-4jLVR7ybcCIO8qENJO8ZYdtwAA75NKXnkdHGARsVzi0YbxH67AM9EHH0AewCP9ex' 'sha384-El-VUQMDWcMUTozokQpFUqYWgcwKQIQSTlnj9N1gN_ZDk8_QOFMJt3uua7eH_5OC' 'sha384-Zj9NV0H7oH8KHW9o3nhwP8Ts0hhyz7OT0qegQ5WFixABR4VIpmyivIVSpuel_TTZ' 'sha384-8vCYaL8lUNzqAa5xLLCcEjmgVx6P31WP7NYHjoqyHdYXGo2AhFFlZNtijoLRYKq1'; font-src 'self' data:; require-trusted-types-for 'script'; trusted-types webpack-tt svg-policy default;";async function E(n,i,o){const c=await caches.open(s),d=await c.match(i);if(d){if(C(i)&&!d.headers.get(r)){const e=d.clone(),t=new Headers(d.headers);t.set(r,W);try{let a=await d.text();T()&&(a=a.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""));const s=new Response(a,{status:e.status,statusText:e.statusText,headers:t});return await c.put(i,s.clone()),s}catch(e){return d}}return d}return async function(n,i){let o;const c=await fetch(n,{keepalive:!0});if(null===c.body)return c;const d=new Headers(c.headers);if(c.status===a){const e=await c.blob(),t=await e.arrayBuffer();o=new Response(t,{headers:d})}else{let e;C(n)?(e=await c.text(),d.set(r,W),T()&&(e=e.replace(/<script id="tt"[\s\S]*?<\/script>/gi,""))):e=await c.blob(),o=new Response(e,{headers:d,status:c.status,statusText:c.statusText})}const u=o.status===t;if(!1===u)return c;u&&e.assets.includes(i)&&(await caches.open(s)).put(n,o.clone());return o}(i,o)}function U(e=Date.now()){const t=new Uint8Array(10);!function(e){if(void 0!==globalThis.crypto&&"function"==typeof globalThis.crypto.getRandomValues)return globalThis.crypto.getRandomValues(e);if("function"==typeof require){const t=require("crypto").randomBytes(e.length);return e.set(t),e}throw new Error("Secure random number generation is not supported in this environment.")}(t);const a=e.toString(16).padStart(12,"0"),s=function(e){let t="";for(let a=0;a<e.length;a++){const s=e[a].toString(16);t+=2===s.length?s:"0"+s}return t}(t);return`${a.substring(0,8)}-${a.substring(8)}-${s.substring(0,4)}-${s.substring(4,8)}-${s.substring(8)}`}function H(e,t=65536){return a=>{if("string"!=typeof a)return!1;const s=String(a).trim();return s.length>=e&&s.length<=t}}const P=(e,t,a,s)=>`Свойство сущности ${e} "${t}" должно быть строкой длиной от ${a} до ${s} символов`;function V(e){const t=Number(e);return"number"==typeof t&&Number.isInteger(t)}const J=(e,t)=>`Свойство сущности ${e} "${t}" должно быть целым числом`;function Q(e){return t=>void 0===t||e(t)}function M(e){return"boolean"==typeof e}function D(e,t){return`Свойство сущности ${e} "${t}" должно быть undefined или boolean`}const Y=(e,t,a,s)=>{const r={error:{message:`Сущность "${s}" должна быть объектом`,data:e}};if(void 0===e)return r;if(!1===function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}(e))return r;const n=e,i=Object.keys(t);for(let e=0;e<i.length;e++){const a=i[e],r=t[a];if(!0===r.required&&void 0===n[a])return{error:{message:`Свойство "${a}" сущности ${s} отсутствует`,data:n}};for(let e=0;e<r.validators.length;e++){const t=r.validators[e];if(!1===t[0](n[a]))return{error:{message:t[1],data:n}}}}return{result:a(n)}},B=e=>{e.currentTarget.setCustomValidity("")},K=(e,t,a)=>s=>{const r=s.currentTarget;let n=`Поле "${e}" обязательно для заполнения`;const i=r.value.replace(/\n/gm,"").trim();return r.validity.patternMismatch?(n=`Поле "${e}" должно начинаться с минимум ${t} символов, исключая спецсимволы и пробелы`,void r.setCustomValidity(n)):i&&(i.length<t||i.length>a)?(n=`Поле "${e}" должно содержать минимум ${t} и максимум ${a} символов`,void r.setCustomValidity(n)):void r.setCustomValidity(n)};function X(e){if(e)return e[0].toUpperCase()+e.slice(1).toLowerCase()}const Z="Задача",z=100,G="Название задачи";K(G,3,z);function F(e){const{title:t,priority_id:a,category_id:s,description:r,expire_date_time:n,deleted:i,completed:o}=e||{};return{title:X(t.trim()),priority_id:Number(a),category_id:s?Number(s):void 0,description:r?.replace(/\s*\n+\s*$/,"").trim(),expire_date_time:n,deleted:i,completed:o}}const ee={title:{validators:[[H(3,z),P(Z,"title",3,z)]],required:!0},priority_id:{validators:[[V,J(Z,"priority_id")]],required:!0},category_id:{validators:[[Q(V),function(e,t){return`Свойство сущности ${e} "${t}" должно быть undefined или целым числом`}(Z,"category_id")]]},expire_date_time:{validators:[[Q((function(e){return"string"==typeof e})),function(e,t){return`Свойство сущности ${e} "${t}" должно быть строкой`}(Z,"expire_date_time")],[Q((function(e){return/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z$/.test(e)})),`Свойство сущности ${Z} "expire_date_time" должно быть датой в формате ISO`]]},deleted:{validators:[[Q(M),D(Z,"deleted")]]},completed:{validators:[[Q(M),D(Z,"completed")]]}},te=e=>Y(e,ee,F,Z);function ae(e){const{task_id:t,title:a,priority_id:s,category_id:r,description:n,expire_date_time:i,deleted:o,completed:c}=e||{};return{task_id:Number(t),title:X(a.trim()),priority_id:Number(s),category_id:r?Number(r):void 0,description:n,expire_date_time:i,deleted:o,completed:c}}const se={task_id:{validators:[[V,J(Z,"task_id")]],required:!0},...ee},re=e=>Y(e,se,ae,Z);function ne(e,t,a=200){return new Response(JSON.stringify({id:e,result:t}),{headers:c,status:a})}class ie{constructor(e,t){this.type=e,this.data=t}}async function oe(t,a){e.clients.matchAll().then((e=>{e.forEach((e=>{e.id!==t&&e.postMessage(a)}))}))}function ce(e,t){const a=te(t);if(!a.error){const s=a.result;if(!e.priorities.find((e=>e.priority_id===s.priority_id)))return{error:{message:"Не известный идентификатор приоритета",data:t}};if(s.category_id){if(!e.categories.find((e=>e.category_id===s.category_id)))return{error:{message:"Не известный идентификатор категории",data:t}}}const r=e.tasks.at(-1)?.task_id||0,n={...s,task_id:r+1};return e.tasks.push(n),{result:n}}return a}function de(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;const a=Object.keys(e),s=Object.keys(t);return a.length===s.length&&a.every((a=>s.includes(a)&&de(e[a],t[a])))}const ue="Категория",le="Название категории";K(le,3,20);function fe(e){const{icon_id:t,category_name:a}=e||{};return{icon_id:Number(t),category_name:X(a.trim())}}const ge={icon_id:{validators:[[V,J(ue,"icon_id")]],required:!0},category_name:{validators:[[H(3,20),P(ue,"category_name",3,20)]],required:!0}},pe=e=>Y(e,ge,fe,ue);function me(e){const{category_id:t,icon_id:a,category_name:s}=e||{};return{category_id:Number(t),icon_id:Number(a),category_name:X(s.trim())}}const ye={category_id:{validators:[[V,J(ue,"category_id")]],required:!0},...ge},_e=e=>Y(e,ye,me,ue);function he(e,t){const a=pe(t);if(a.result){const s=a.result,r=e.categories.find((e=>e.category_name===s.category_name));if(r)return{error:{message:"Категория с таким именем уже существует",data:t}};if(!e.icons.find((e=>e.icon_id===s.icon_id)))return{error:{message:"Не известный идентификатор иконки",data:t}};const n=e.categories.at(-1)?.category_id||0,i={...s,category_id:n+1};return e.categories.push(i),{result:i}}return a}function we(e){const t=(a=e.tasks,"structuredClone"in globalThis?I.structuredClone(a):a);var a;return e.tasks=[],{result:t}}function be(){return Promise.resolve(new Response(JSON.stringify({error:{code:404,error:"Not found"}}),{headers:c,status:200}))}async function ke(e){const{request:t}=e,a=(await t.json()).id||U();return new Response(JSON.stringify({id:a,result:"Ok"}),{headers:c,status:200})}const ve={[o]:async function(e){const{request:t}=e,a=await j(),s=t.headers.get("x-request-id");return new Response(JSON.stringify({id:s,result:a}),{headers:c,status:200})},[u]:async function(e){const{request:t}=e,a=v(),{id:s,params:r}=await t.json(),n=he(a,r);if(n.result){const t=n.result;return await x(a),await oe(e.clientId,new ie("create_category",t)),ne(s,t)}return L(s,n.error.message,n.error.data)},[l]:async function(e){const{request:t}=e,a=v(),{id:s,params:r}=await t.json(),n=function(e,t){const a=_e(t);if(a.result){const s=a.result;let r=e.categories.findIndex((e=>e.category_id===s.category_id));return-1===r?{error:{message:"Категория не найдена",data:t}}:e.categories.find((e=>e.category_name===s.category_name&&e.category_id!==s.category_id))?{error:{message:"Категория с таким именем уже существует",data:t}}:e.icons.find((e=>e.icon_id===s.icon_id))?(r=e.categories.findIndex((e=>e.category_id===s.category_id)),e.categories[r]=s,{result:s}):{error:{message:"Не известный идентификатор иконки",data:t}}}return a}(a,r);if(n.result){const t=n.result;return x(a),await oe(e.clientId,new ie("update_category",t)),ne(s,t)}return L(s,n.error.message,n.error.data)},[f]:async function(e){const{request:t}=e,a=v(),{id:s,params:r}=await t.json(),n=function(e,t){const a=_e(t);if(a.result){const s=a.result,r=e.categories.findIndex((e=>de(e,s)));return-1===r?{error:{message:"Категория не найдена",data:t}}:e.tasks.find((e=>e.category_id===s.category_id))?{error:{message:"Категория используется в задачах",data:t}}:(e.categories.splice(r,1),{result:s})}return a}(a,r);if(n.result){const t=n.result;return x(a),await oe(e.clientId,new ie("delete_category",t)),ne(s,t)}return L(s,n.error.message,n.error.data)},[g]:async function(e){const{request:t}=e,a=v(),{id:s,params:r}=await t.json(),n=ce(a,r);if(n.result){const t=n.result;return await x(a),await oe(e.clientId,new ie(g,t)),ne(s,t)}return L(s,n.error.message,n.error.data)},[p]:async function(e){const{request:t}=e,a=v(),{id:s,params:r}=await t.json(),n=function(e,t){const a=re(t);if(a.result){const s=a.result,r=e.tasks.findIndex((e=>e.task_id===s.task_id));return-1===r?{error:{message:"Задача не найдена",data:t}}:e.priorities.find((e=>e.priority_id===s.priority_id))?s.category_id&&!e.categories.find((e=>e.category_id===s.category_id))?{error:{message:"Не известный идентификатор категории",data:t}}:(e.tasks[r]=s,{result:s}):{error:{message:"Не известный идентификатор приоритета",data:t}}}return a}(a,r);if(n.result){const t=n.result;return await x(a),await oe(e.clientId,new ie(p,t)),ne(s,t)}return L(s,n.error.message,n.error.data)},[m]:async function(e){const{request:t}=e,a=v(),{id:s,params:r}=await t.json(),n=function(e,t){const a=re(t);if(a.result){const s=a.result,r=e.tasks.findIndex((e=>de(ae(e),ae(s))));return-1===r?{error:{message:"Задача не найдена",data:t}}:(e.tasks.splice(r,1),{result:s})}return a}(a,r);if(n.result){const t=n.result;return await x(a),await oe(e.clientId,new ie(m,t)),ne(s,t)}return L(s,n.error.message,n.error.data)},[y]:async function(e){const{request:t}=e,a=v(),{id:s}=await t.json(),r=we(a);if(r.result){const t=r.result;return await x(a),await oe(e.clientId,new ie(y)),ne(s,t)}return L(s,r.error.message,r.error.data)},[_]:async function(e){const{request:t}=e,a={failed:{categories:[],tasks:[]},imported:{categories:[],tasks:[]}},s={categories:[]},{id:r,params:n}=await t.json();if(n){const t=v(),{tasks:i,categories:o}=n;if(!(i&&Array.isArray(i)&&o&&Array.isArray(o)))return L(r,"Не валидные данные");for(let e=0;e<i.length;e++){const r=i[e];let n;if(r.category_id){const e=o.find((e=>e.category_id===r.category_id));e&&(s.categories.includes(e.category_name)||(n=he(t,e),n.error?a.failed.categories.push(n.error):a.imported.categories.push(n.result),s.categories.push(e.category_name)))}t.tasks.find((e=>e.title===r.title&&e.description===r.description&&e.priority_id===r.priority_id&&e.category_id===r.category_id&&e.completed==r.completed&&e.deleted==r.deleted&&e.expire_date_time==r.expire_date_time))?a.failed.tasks.push({message:"Задача уже существует",data:r}):(n=ce(t,r),n.error?a.failed.tasks.push(n.error):a.imported.tasks.push(n.result))}(a.imported.categories.length>0||a.imported.tasks.length>0)&&x(t);const c=a.imported;return(c.categories.length>0||c.tasks.length>0)&&await oe(e.clientId,new ie(_,a.imported)),ne(r,a)}return L(r,"Не удалось импортировать задачи")},"/log/info":ke,"/log/warn":ke,"/log/error":ke};async function xe(e,t){const a=async function(e,t){return 0===v().icons.length&&await j(),(ve[t]||be)(e)}(e,t);return a}var qe;qe=globalThis,I=qe,e.id=Date.now(),e.VERSION="1.22.34",e.assets=R,e.isRepearing=!1,e.logger=A,e.onerror=S,e.addEventListener("message",(function(t){t.data&&"SKIP_WAITING"===t.data.type&&e.skipWaiting()})),e.addEventListener("fetch",(async function(t){const a=t.request,r=function(e){const{pathname:t}=new URL(e);return t.startsWith(i)?t.slice(i.length):t}(a.url);switch(a.method){case"GET":return await async function(t,a){if("document"!==t.request.destination||a!==O)e.assets.includes(a)&&t.respondWith(E(0,t.request.url,a));else{const a=e.assets.find((e=>e.startsWith(`${O}offline.`)&&e.endsWith(".html")))||"";t.respondWith(E(0,a,a))}}(t,r),void t.waitUntil(async function(){const t=await caches.open(s),a=(await t.keys()).map((e=>new URL(e.url).pathname)),r=e.assets.filter((e=>!a.includes(e)&&!e.startsWith("/offline.")));if(r.length>0&&!e.isRepearing){e.isRepearing=!0;try{await t.addAll(r)}finally{e.isRepearing=!1}}}());case"POST":{const{origin:e}=new URL(t.request.referrer);if(!t.request.url.startsWith(e))return;if(t.request.url.indexOf("/ai/")>0)return;return void t.respondWith(xe(t,r))}default:t.respondWith(L(-1,"Не допустимый http метод"))}})),e.addEventListener("install",(async function(t){t.waitUntil(async function(){const t=await caches.open(s),a=(await t.keys()).map((e=>new URL(e.url).pathname)),r=e.assets.filter((e=>{const t=e.split(".").pop()||"";return n.includes(t)&&!a.includes(e)}));e.loadedAssets=r,r.length>0&&await t.addAll(r)}())})),e.addEventListener("activate",(async function(t){t.waitUntil($()),t.waitUntil(e.clients.claim())}))})();
>>>>>>> ee667643babde19574893bc26c5c782975ac928e
